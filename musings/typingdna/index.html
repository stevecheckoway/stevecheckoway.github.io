<!DOCTYPE html><html lang=en><meta http-equiv=Content-Type content="text/html;charset=utf-8"> <meta http-equiv=X-UA-Compatible content="IE=edge"> <meta name=viewport content="width=device-width, initial-scale=1"><title>TypingDNA Authenticator sends its users' secrets to the cloud (updated)</title><meta name=description content="TypingDNA Authenticator is browser-based authenticator app that is designed to replace mobile phone authenticator apps like Google Authenticator and Duo Mobi..."> <link rel=canonical href=https://checkoway.net/musings/typingdna/> <link rel=stylesheet href=/css/main.css><main><article class=post vocab=http://schema.org typeof=BlogPosting><div class=post-header><h1 class=post-title property=headline>TypingDNA Authenticator sends its users’ secrets to the cloud (updated)</h1><p class=post-meta><time datetime=2018-05-09T00:00:00-04:00 property=datePublished>May 9, 2018</time> • <span property=author typeof=Person><span property=name>Stephen Checkoway</span></span></div><div class=post-content property=articleBody><p><a href=https://www.typingdna.com/authenticator>TypingDNA Authenticator</a> is browser-based authenticator app that is designed to replace mobile phone authenticator apps like Google Authenticator and <a href=https://duo.com/product/trusted-users/two-factor-authentication/duo-mobile>Duo Mobile</a>. Like Google Authenticator and Duo Mobile, TypingDNA Authenticator uses <a href=https://en.wikipedia.org/wiki/Time-based_One-time_Password_algorithm>Time-based One-Time Passwords</a> (TOTP) to produce short codes that users use as a <a href=https://en.wikipedia.org/wiki/Multi-factor_authentication>second factor</a> (alongside traditional user names and passwords) to log in to websites.<p>At the time of writing (2018-05-09), TypingDNA Authenticator version 0.0.28 exposes users’ TOTP secrets to Google. In addition, it logs every interaction the user has with the extension pop up page via Google Analytics, including which services users create accounts with. <strong>As of 0.0.30, both issues have been resolved. See updates below.</strong><h1 id=totp>TOTP</h1><p>TOTP is a clever approach to multi-factor authentication. When the user of a website that supports TOTP wishes to enable it, the web server generates a secret value<sup id=fnref:1><a href=#fn:1 class=footnote>1</a></sup> which it shares with the user.<p>The secret is typically shared by showing a <a href=https://en.wikipedia.org/wiki/QR_code>quick response</a> (QR) code which encodes a <a href=https://github.com/google/google-authenticator/wiki/Key-Uri-Format>OTPAUTH URI</a>. The user will scan this code with her authenticator app which then records the information.<p>The OTPAUTH URI contains a label (e.g., the user’s email address), the TOTP secret, and the issuer (the service that the account is associated with).<p>For <a href=https://github.com/google/google-authenticator/wiki/Key-Uri-Format>example</a>, the URI<div class=highlighter-rouge><div class=highlight><pre class=highlight><code>otpauth://totp/Example:alice@google.com?secret=JBSWY3DPEHPK3PXP&amp;issuer=Example
</code></pre></div></div><p>is issued by <code class=highlighter-rouge>Example</code> for <code class=highlighter-rouge>alice@google.com</code> and has the base-32-encoded secret <code class=highlighter-rouge>JBSWY3DPEHPK3PXP</code>. This URI could be displayed to the user as the following QR code which the user would typically scan with an authenticator app.<p><img src=/assets/posts/typingdna/exampleqr.png alt="QR code for example URI"><p>When the user wants to log in to a website, she will typically enter her user name and password as well as a 6–8 digit code generated by her authentication app. The authentication app generates the code by combining the secret from the QR code with the current time using an <a href=https://en.wikipedia.org/wiki/HMAC>HMAC</a>. The full details are spelled out in <a href=https://tools.ietf.org/html/rfc6238>RFC 6238</a>. The web server performs the same computation, computing the expected digits from the shared secret and the current time and compares the expected value with the value received from the user. If they match, then the user is authenticated.<h1 id=exposing-secrets-via-google-charts>Exposing secrets via Google Charts</h1><p>To add new accounts to TypingDNA Authenticator, the user logs in to the TypingDNA service via the Chrome extension.<sup id=fnref:2><a href=#fn:2 class=footnote>2</a></sup> Next, the extension asks Chrome to take a screen shot of the current tab which the extension scans for the presence of a QR code containing an OTPAUTH URI. Finally, the three components of the OTPAUTH URI are extracted, encrypted, and stored locally.<p>The encryption key comes from the TypingDNA service after successfully logging in and is not stored locally.<p>Users are free to modify or export their TOTP data by clicking on the pencil icon.<p><img src=/assets/posts/typingdna/typingdnaauth.png alt="TypingDNA UI"><p>Doing so opens a new window displaying, among other things, a QR code encoding the OTPAUTH URI. The idea is that users can scan the QR code with another authenticator app if they wish.<p><img src=/assets/posts/typingdna/typingdnaqr.png alt="TypingDNA QR code"><p>The problem is in how this QR code is generated.<p>Google Charts has a deprecated <a href=https://developers.google.com/chart/infographics/docs/qr_codes>API</a> which developers can use to embed a QR code using an HTTP GET request that contains the data to be encoded.<p>TypingDNA Authenticator uses this API to fetch a QR code containing the OTPAUTH URI which itself contains the TOTP secret. The relevant code from the extension is this JavaScript function.<div class="language-javascript highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=kd>function</span> <span class=nx>showQRCode</span><span class=p>(</span><span class=nx>qrbool0</span><span class=p>)</span> <span class=p>{</span>
  <span class=kd>var</span> <span class=nx>qrbool</span> <span class=o>=</span> <span class=nx>qrbool0</span> <span class=o>||</span> <span class=kc>true</span><span class=p>;</span>
  <span class=kd>var</span> <span class=nx>account</span> <span class=o>=</span> <span class=nx>$</span><span class=p>(</span><span class=dl>'</span><span class=s1>#accountNameIE</span><span class=dl>'</span><span class=p>).</span><span class=nx>val</span><span class=p>()</span>
  <span class=kd>var</span> <span class=nx>issuer</span> <span class=o>=</span> <span class=nx>account</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=dl>"</span><span class=s2> </span><span class=dl>"</span><span class=p>)[</span><span class=mi>0</span><span class=p>];</span>
  <span class=kd>var</span> <span class=nx>accountStr</span> <span class=o>=</span> <span class=nx>account</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=dl>"</span><span class=s2>(</span><span class=dl>"</span><span class=p>,</span> <span class=dl>"</span><span class=s2>:</span><span class=dl>"</span><span class=p>).</span><span class=nx>replace</span><span class=p>(</span><span class=dl>"</span><span class=s2>)</span><span class=dl>"</span><span class=p>,</span> <span class=dl>""</span><span class=p>).</span><span class=nx>replace</span><span class=p>(</span><span class=dl>"</span><span class=s2> </span><span class=dl>"</span><span class=p>,</span> <span class=dl>""</span><span class=p>);</span>
  <span class=kd>var</span> <span class=nx>secret</span> <span class=o>=</span> <span class=nx>$</span><span class=p>(</span><span class=dl>'</span><span class=s1>#accountSecretIE</span><span class=dl>'</span><span class=p>).</span><span class=nx>val</span><span class=p>();</span>
  <span class=kd>var</span> <span class=nx>url</span> <span class=o>=</span> <span class=dl>"</span><span class=s2>https://www.google.com/chart?chs=250x250&amp;chld=M|0&amp;cht=qr&amp;chl=otpauth://totp/</span><span class=dl>"</span> <span class=o>+</span> <span class=nx>accountStr</span> <span class=o>+</span> <span class=dl>"</span><span class=s2>?secret=</span><span class=dl>"</span> <span class=o>+</span> <span class=nx>secret</span> <span class=o>+</span> <span class=dl>"</span><span class=s2>&amp;issuer=</span><span class=dl>"</span> <span class=o>+</span> <span class=nx>issuer</span><span class=p>;</span>
  <span class=nx>$</span><span class=p>(</span><span class=dl>'</span><span class=s1>#qrdiv</span><span class=dl>'</span><span class=p>).</span><span class=nx>html</span><span class=p>(</span><span class=dl>"</span><span class=s2>&lt;img src='</span><span class=dl>"</span> <span class=o>+</span> <span class=nx>url</span> <span class=o>+</span> <span class=dl>"</span><span class=s2>'&gt;</span><span class=dl>"</span><span class=p>);</span>
  <span class=k>if</span> <span class=p>(</span><span class=nx>qrbool</span> <span class=o>==</span> <span class=kc>true</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>trackPage</span><span class=p>(</span><span class=dl>"</span><span class=s2>showQR</span><span class=dl>"</span><span class=p>);</span>
    <span class=nx>$</span><span class=p>(</span><span class=dl>'</span><span class=s1>#qrdiv</span><span class=dl>'</span><span class=p>).</span><span class=nx>show</span><span class=p>();</span>
  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
    <span class=nx>$</span><span class=p>(</span><span class=dl>'</span><span class=s1>#qrdiv</span><span class=dl>'</span><span class=p>).</span><span class=nx>hide</span><span class=p>();</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div></div><p>You can see the <code class=highlighter-rouge>url</code> variable contains the OTPAUTH URI as a GET parameter. Google Chrome’s developer tools can be used to verify that this is indeed how the QR code is generated.<p>The QR code in the image above was fetched from this URL.<div class=highlighter-rouge><div class=highlight><pre class=highlight><code>https://www.google.com/chart?chs=250x250&amp;chld=M|0&amp;cht=qr&amp;chl=otpauth://totp/Example:alice@google.com?secret=JBSWY3DPEHPK3PXP&amp;issuer=Example
</code></pre></div></div><p>I’ve copied the image locally since this particular API is deprecated.<p><img src=/assets/posts/typingdna/cachedqr.png alt="QR code from Google"><h1 id=logging-interactions-with-the-extension>Logging interactions with the extension</h1><p>The TypingDNA Authenticator extension uses Google Analytics extensively to track every interaction you have with the extension. Each button you click and each page of the extension is tracked using Google Analytics.<p>In my experiments, both HTTP and HTTPS requests were made for each tracked action. Some of the logged information includes<ul><li>Issuers (service names) for each account created<li>Error messages<li>Buttons pressed<li>Settings changed<li>Each page of the extension viewed (e.g., the registration, login, add and edit accounts, and show QR code pages)<li>The fact that the TOTP code was copied by clicking on it (but not the code itself)</ul><p>I’m not sure why this information is being tracked at all, let alone with such fine granularity.<p>The one obviously sensitive piece of information that is being logged via Google Analytics that I’ve seen is the names of the services where the user has created an account. That said, I’ve only taken a cursory look at the information that is being tracked so there could be more.<p>This tracking data, including service names, is initially sent in the clear using HTTP. Google servers respond with a temporary redirect to their HTTPS pages. Thus anyone who can see a TypingDNA user’s network traffic while she adds a new account can see which service she is using. This is in addition to TypingDNA who can see all of the services all of their users are using.<h1 id=conclusions>Conclusions</h1><p>I have reported my findings to TypingDNA and will update this post if I hear back.<p>In the meantime, you should avoid using TypingDNA Authenticator.<p><strong>Updates:</strong><ol><li><p>2018-05-09. The title and description of this post were updated from “TypingDNA Authenticator shares secrets with Google” and “TypingDNA Authenticator Google Chrome extension shares TOTP secrets with Google and tracks your actions” respectively to better reflect the fact that, although Google is the recipient of this information, Google was not involved in the decision to share the information.<p>The second paragraph was updated to explicitly mention the sharing of the services’ names via Google Analytics. The last paragraph of logging section was added to point out that the logging information is revealed over HTTP.<li><p>The CEO of TypingDNA, Raul Popa, emailed me. He said that TypingDNA Authenticator will be updated to generate QR codes locally, without the use of the Google Charts API. He defended the fine-grained use of Google Analytics for tracking how users use the extension, including which services users use. The use of HTTP rather than HTTPS appears to be due to Google’s <code class=highlighter-rouge>ga.js</code> script.<li><p>2018-05-22. As of version 0.0.30, TypingDNA Authenticator no longer uses Google APIs to generate QR codes. The QR images displayed are now created entirely in JavaScript. Furthermore, the service names are no longer sent via Google Analytics.<p>I appreciate that TypingDNA took quick action to update their software.</ol><h1 id=notes>Notes</h1><div class=footnotes><ol><li id=fn:1><p>This value is unrelated to the user’s password. It’s typically just a pseudorandomly-chosen integer.&nbsp;<a href=#fnref:1 class=reversefootnote>↩</a><li id=fn:2><p>I have some concerns around whether this is actually a second factor in a multi-factor authentication scheme since what you need to log in to TypingDNA’s service is an email address and optionally a password. Their claim is that <em>how</em> one types can be used as a biometric identifier and the extension records how you type your email address and password and sends that off to the service to validate you. I have some security and privacy concerns about this approach separate from the issues described here.&nbsp;<a href=#fnref:2 class=reversefootnote>↩</a></ol></div></div><div class=post-footer><p class=post-meta>Last updated <time datetime=2018-05-22T00:00:00-04:00 property=dateModified>May 22, 2018</time>.</div></article></main>