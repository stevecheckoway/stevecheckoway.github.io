<!DOCTYPE html><html lang=en><meta http-equiv=Content-Type content="text/html;charset=utf-8"> <meta http-equiv=X-UA-Compatible content="IE=edge"> <meta name=viewport content="width=device-width, initial-scale=1"><title>Radare2: First impressions</title><meta name=description content="Update (2016-11-01): The Radare2 creator has informed me that all of the issues I mention below have been fixed."> <link rel=canonical href=https://checkoway.net/musings/radare2-first-impressions/> <link rel=stylesheet href=/css/main.css><main><article class=post vocab=http://schema.org typeof=BlogPosting><div class=post-header><h1 class=post-title property=headline>Radare2: First impressions</h1><p class=post-meta><time datetime=2016-10-29T00:00:00+00:00 property=datePublished>Oct 29, 2016</time> • <span property=author typeof=Person><span property=name>Stephen Checkoway</span></span></div><div class=post-content property=articleBody><p><strong>Update (2016-11-01): The Radare2 creator has informed me that all of the issues I mention below have been fixed.</strong><blockquote class=twitter-tweet data-lang=en><p lang=en dir=ltr>.<a href=https://twitter.com/stevecheckoway>@stevecheckoway</a> i fixed all the issues you say in the post. but anyway, r2 is far from perfect, but everything works if you use it properly</p>— pancake (@trufae) <a href=https://twitter.com/trufae/status/793513835311357953>November 1, 2016</a></blockquote><script async src=//platform.twitter.com/widgets.js charset=utf-8></script><p><strong>Note carefully the date this was published. It’s entirely possible that all of the problems I mention below have long since been fixed.</strong><p>I’ve spent a <a href=/papers/evt2009/>fair</a> <a href=/papers/car2010/>bit</a> <a href=/papers/car2011/>of</a> <a href=/papers/dualec2014/>time</a> <a href=/papers/radsec2014/>reverse</a> <a href=/papers/iseeyou2014/>engineering</a> <a href=/papers/juniper2016/>firmware</a> using <a href=https://www.hex-rays.com/products/ida/>IDA</a>. I have never been completely happy with IDA. It improved dramatically with the new UI and Python bindings, but I think it has been hampered by early design decisions. (To name but one, it’s impossible for a segment to be not 16-byte aligned which is a hold-over from the Intel 8086. The 34 year old Intel 80286 introduced <a href=https://en.wikipedia.org/wiki/Intel_80286#Protected_mode>protected mode</a> which supports arbitrary segment alignment and IDA just cannot handle it.) Still, I’ve been moderately successful reverse engineering firmware for a wide variety of processor architectures using IDA. Unfortunately, IDA is expensive. Like, really, <em>really</em> <a href=https://www.hex-rays.com/products/ida/order.shtml>expensive</a>.<p>Several competing tools have recently become popular. Yesterday, I gave <a href=http://rada.re/r/>radare2</a> a spin for the first time. I started by reading through the <a href=https://radare.gitbooks.io/radare2book/content/>Radare2 Book</a>. Almost immediately, I noticed some odd design choices. For example, the <code class="language-plaintext highlighter-rouge">rax2</code> tool has a very unintuitive (to me) interface.<blockquote class=twitter-tweet data-lang=en><p lang=en dir=ltr>Mishmash of prefixes, suffixes, and prefix modifications. Does anyone find this intuitive?<br>Better design: unambiguous input; specify output? <a href=https://t.co/YCrCjZISlM>pic.twitter.com/YCrCjZISlM</a></p>— Stephen Checkoway (@stevecheckoway) <a href=https://twitter.com/stevecheckoway/status/792074703099731969>October 28, 2016</a></blockquote><script async src=//platform.twitter.com/widgets.js charset=utf-8></script><p>But any new tool is going to take some time to learn, so I pressed on. I compiled and installed the main radare2 binaries. As a first test, I ran <code class="language-plaintext highlighter-rouge">r2 /usr/bin/true</code> and entered visual mode with the <code class="language-plaintext highlighter-rouge">V</code> command.<p><img src=/assets/posts/radare2-first-impressions/r2-visual.png alt="r2 visual mode"><p>So far so good! Since radare2 uses vim-esque movement key bindings (hjkl), I scrolled around a little bit but almost immediately noticed something odd. After scrolling down once (j) and then back up once (k), I’d expect to see the same thing as before, but instead, I get this.<p><img src=/assets/posts/radare2-first-impressions/r2-visual-scrolled.png alt="r2 visual mode scrolled"><p>So it scrolled a little too far, but wait, what’s that <code class="language-plaintext highlighter-rouge">call qword [rbp + 0x48]</code>? Apparently, it decided to move the <code class="language-plaintext highlighter-rouge">ff</code> byte that preceded <code class="language-plaintext highlighter-rouge">main</code> <em>into</em> main, thus changing the disassembly! In fact, scrolling right or left, changes the offset of the start of the disassembly. As near as I can tell, left decrements the offset by one, right increments it by one, up decrements it by four, and down increments it by the size of the instruction. I can imagine why one might want similar functionality, but it’s surprising for it to be the default.<p>After performing some code analysis (command <code class="language-plaintext highlighter-rouge">aa</code>), this behavior disappears and up and down scroll by an instruction. Left and right keep their behavior.<p>Next up: visual panel mode (command <code class="language-plaintext highlighter-rouge">!</code> in visual mode). This seems neat (although the arrows don’t seem to respect the UTF-8 setting.) Unfortunately, this mode seems very buggy. For example, immediately after opening the visual panel mode, opening the <code class="language-plaintext highlighter-rouge">File</code> menu and selecting <code class="language-plaintext highlighter-rouge">Close</code> twice causes <code class="language-plaintext highlighter-rouge">r2</code> to segfault. I’ve managed other segfaults in this mode, but I’m not entirely sure what caused them. This reminds me a lot of GDB’s Text User Interface (TUI) mode which crashes essentially every time I use it.<p>After performing analyses which can take some time, renaming functions, or adding comments, it’d be great to be able to save my work and come back to it. Radare2 has a notion of a project. The <code class="language-plaintext highlighter-rouge">P</code> command can open and save projects.<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>[0x100000f33]&gt; P?
|Usage: P[?osi] [file]Project management
| Pc [file]    show project script to console
| Pd [file]    delete project
| Pi [file]    show project information
| Pl           list all projects
| Pn[j]        show project notes (Pnj for json)
| Pn [base64]  set notes text
| Pn -         edit notes with cfg.editor
| Po [file]    open project
| Ps [file]    save project
| PS [file]    save script file
| NOTE:        See 'e??prj.'
| NOTE:        project are stored in ~/.config/radare2/projects
</code></pre></div></div><p>So let’s give that a shot. First, I’ll run <code class="language-plaintext highlighter-rouge">r2 /usr/bin/true</code> again, run <code class="language-plaintext highlighter-rouge">aa</code>, and then save the project.<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>[0x100000f33]&gt; aa
[x] Analyze all flags starting with sym. and entry0 (aa)
[0x100000f33]&gt; Ps true
true
</code></pre></div></div><p>This creates a <code class="language-plaintext highlighter-rouge">~/.config/radare2/projects/true</code> directory containing two files.<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>$ ls -l ~/.config/radare2/projects/true
total 68
-rw-r--r-- 1 steve staff 64653 Oct 29 14:26 rc
-rw-r--r-- 1 steve staff  1393 Oct 29 14:26 xrefs
</code></pre></div></div><p>So far so good. Now that I’ve saved a project, I should be able to see it in the list of projects using the <code class="language-plaintext highlighter-rouge">Pl</code> command.<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>[0x100000f33]&gt; Pl
[0x100000f33]&gt; Pl?
[0x100000f33]&gt;
</code></pre></div></div><p>I guess not? Okay, I’ll try seeking one byte forward, just to change the state a little and then reopen the project.<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>[0x100000f33]&gt; s +1
[0x100000f34]&gt; Po true
Close current session? (Y/n)
[0x100000f33]&gt;
</code></pre></div></div><p>Okay, that seems good. Since I performed the <code class="language-plaintext highlighter-rouge">aa</code> before saving the project, surely, that information has been saved, right? No, no it wasn’t. I have no idea why. That seems like pretty essential information to save.<p>Using the <code class="language-plaintext highlighter-rouge">-p</code> command line flag, we can open a project. That seems handy. As a final project management test, I’ll open a project with <code class="language-plaintext highlighter-rouge">-p</code>, ask for a list of projects and then quit and save.<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>$ r2 -p true
[0x100000f31]&gt; Pl
[0x100000f31]&gt; q
Do you want to save the 'true' project? (Y/n)
r_sys_mkdirp: fail '/Users/steve/.config/radare2/projects/true/rc/rop' of '/Users/steve/.config/radare2/projects/true/rc/rop'
sdb: Cannot open '/Users/steve/.config/radare2/projects/true/rc/rop/nop.tmp' for writing.
r_sys_mkdirp: fail '/Users/steve/.config/radare2/projects/true/rc/rop' of '/Users/steve/.config/radare2/projects/true/rc/rop'
sdb: Cannot open '/Users/steve/.config/radare2/projects/true/rc/rop/mov.tmp' for writing.
r_sys_mkdirp: fail '/Users/steve/.config/radare2/projects/true/rc/rop' of '/Users/steve/.config/radare2/projects/true/rc/rop'
sdb: Cannot open '/Users/steve/.config/radare2/projects/true/rc/rop/const.tmp' for writing.
r_sys_mkdirp: fail '/Users/steve/.config/radare2/projects/true/rc/rop' of '/Users/steve/.config/radare2/projects/true/rc/rop'
sdb: Cannot open '/Users/steve/.config/radare2/projects/true/rc/rop/arithm.tmp' for writing.
r_sys_mkdirp: fail '/Users/steve/.config/radare2/projects/true/rc/rop' of '/Users/steve/.config/radare2/projects/true/rc/rop'
sdb: Cannot open '/Users/steve/.config/radare2/projects/true/rc/rop/arithm_ct.tmp' for writing.
</code></pre></div></div><p>Since <code class="language-plaintext highlighter-rouge">rc</code> is a file, not a directory, saving is failing. I have no idea why. Opening a project using <code class="language-plaintext highlighter-rouge">Po</code> and then saving has the same behavior. I guess projects aren’t usable.<p>Finally, I took a look at a little bit of the broader radare2 ecosystem. Radare2 comes with a package manager <code class="language-plaintext highlighter-rouge">r2pm</code> which can install packages. First up, the <a href=https://github.com/radare/radare2-webui>webui</a> packages. Following the directions, I tried to install <code class="language-plaintext highlighter-rouge">www-m</code>.<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>$ r2pm -i www-m
Processing www-m ...
Already up-to-date.
Install Done For www-m
make -C www/m build
...
/Users/steve/.config/radare2/r2pm/db/www-m: line 11: cd: dist/m: No such file or directory
</code></pre></div></div><p>So that didn’t work. What about the Python-GTK UI, Bokken?<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>$ r2pm -i bokken
Processing bokken ...
...
Install Done For bokken
abort: error: Connection refused
sys/bokken.sh: line 14: cd: bokken: No such file or directory
</code></pre></div></div><p>So r2pm installed it, but then failed twice. Since <code class="language-plaintext highlighter-rouge">r2pm -l</code> claims Bokken is installed, but the installation clearly failed, let’s try removing it.<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>$ r2pm -u bokken
Processing bokken ...
Already up-to-date.
Uninstall Done For bokken
Sorry. This package cannot be uninstalled
</code></pre></div></div><p>Maybe the package manager isn’t up to date.<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>$ r2pm update
Already up-to-date.
r2pm database initialized. Use 'r2pm update' to update
</code></pre></div></div><p>Why does the update command tell me to run update?<p>Okay, final thing. IDA can decompile binaries for several architectures into C (assuming you’ve shelled out even more money for the decompiler). Radare2 has a <a href=https://github.com/radare/radeco>package</a> that can do that, although I understand it’s still a work in progress. Still, this could be a nice, free alternative.<p>I’ll spare you the hundreds of lines of errors that result from running <code class="language-plaintext highlighter-rouge">r2pm -i radeco</code>.<p>In summary, I had a pretty frustrating day playing with radare2. It seems like it could be a nice alternative to spending thousands of dollars on IDA, but as far as I can tell, it’s currently buggy and unusable.</div><div class=post-footer><p class=post-meta>Last updated <time datetime=2016-11-01T00:00:00+00:00 property=dateModified>Nov 1, 2016</time>.</div></article></main>