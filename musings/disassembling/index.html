<!DOCTYPE html><html lang=en><meta http-equiv=Content-Type content="text/html;charset=utf-8"> <meta http-equiv=X-UA-Compatible content="IE=edge"> <meta name=viewport content="width=device-width, initial-scale=1"><title>On Disassembling Embedded Code</title><meta name=description content="In the past few years, I’ve spent a fair bit of time disassembling code for embedded devices. Over time, I’ve built up mental lists of properties that embedd..."> <link rel=canonical href=https://checkoway.net/musings/disassembling/> <link rel=stylesheet href=/css/main.css><main><article class=post vocab=http://schema.org typeof=BlogPosting><div class=post-header><h1 class=post-title property=headline>On Disassembling Embedded Code</h1><p class=post-meta><time datetime=2010-04-18T00:00:00-04:00 property=datePublished>Apr 18, 2010</time> • <span property=author typeof=Person><span property=name>Stephen Checkoway</span></span></div><div class=post-content property=articleBody><p>In the past few years, I’ve spent a fair bit of time disassembling code for embedded devices. Over time, I’ve built up mental lists of properties that embedded devices can have that facilitate or frustrate disassembly. I’m sure that by now, I’ve forgotten some of these properties, so I decided it was time to make some lists.<p>And so, without further ado and in no particular order, properties of embedded devices that facilitate disassembly.<ul><li>Contains internal symbols.<li>Dynamically linked (so it contains external symbols).<li>Uses example code (often without checks for error conditions) with few modifications.<li>Contains debugging messages/error messages.<li>Provides a UNIX-like environment, complete with a debugger.<li>Optimizations turned on. While this typically makes debugging one’s own code difficult since the debugger has difficulty single stepping high level instructions, if I’m disassembling, I don’t have the source so I don’t care about associating assembly with C and optimizations eliminate constantly loading and storing values, superfluous register moves, dead code, etc.<li>Brings UART pins out on the board. I’m happy to solder wires to a MM232R and read your debugging messages while the device operates or interact with the shell you helpfully connected to the UART for testing.<li>Runs code directly from the ROM.</ul><p>And now properties that frustrate disassembly. Since absence of properties in the first list tend to frustrate disassembly, the lack of their presence is not duplicated below.<ul><li>Statically linked. I end up wasting lots of time disassembling various standard library functions.<li>Optimizations turned on. Sometimes, the compiler is simply smarter than I am and things like slightly different versions of loops depending on data address alignment is a serious time-waster (for the one whose time matters most: me). So I said optimizations both facilitated and frustrated disassembly; what’s your point?<li>Contains hand-written assembly that doesn’t follow standard parameter passing conventions.<li>Written in C++. In particular, virtual function calls.<li>Contains misleading/incorrect error messages.<li>Passes data using global variables.<li>Changes argument order. Think <code class="language-plaintext highlighter-rouge">foo(a,b,c)</code> calls <code class="language-plaintext highlighter-rouge">bar(c,a,b)</code> calls <code class="language-plaintext highlighter-rouge">baz(b,c,a)</code>.<li>Runs on an architecture that has branch delay slots.<li>Contains machine generated code. Think Lex or Yacc.<li>Is a state machine.<li>Uses tightly coupled threads.<li>Written by programmers who don’t understand basic synchronization mechanisms.<li>Code gets copied piece by piece from ROM to RAM by a bootloader. (Substitute Flash for ROM as desired.)<li>Uses memory overlays.<li>Monolithic.<li>Self-modifying.<li>Contains triply nested loops (or deeper).<li>Contains mutually recursive functions.<li>Passes around function pointers.<li>Written for an architecture not supported by IDA Pro.</ul><p>Some of these properties are intentional, others are fortuitous, and some are simply mistakes. I have encountered all of these properties at one time or another, but no single embedded device contains all of them.<p>I am very thankful to designers/implementers of embedded devices who include elements from the first list and curse the names of those who include elements of the second list. The two are not mutually exclusive.</div><div class=post-footer><p class=post-meta>Last updated <time datetime=2010-04-18T00:00:00-04:00 property=dateModified>Apr 18, 2010</time>.</div></article></main>