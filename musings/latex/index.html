<!DOCTYPE html><html lang=en><meta http-equiv=Content-Type content="text/html;charset=utf-8"> <meta http-equiv=X-UA-Compatible content="IE=edge"> <meta name=viewport content="width=device-width, initial-scale=1"><title>More LaTeX Hacking</title><meta name=description content="After I presented “Are Text-Only Data Formats Safe? Or, Use This LaTeX Class File to Pwn Your Computer” at LEET 2010, I was asked if I planned to do any more..."> <link rel=canonical href=https://checkoway.net/musings/latex/> <link rel=stylesheet href=/css/main.css> <link rel=stylesheet href=/css/TeX.css><main><article class=post vocab=http://schema.org typeof=BlogPosting><div class=post-header><h1 class=post-title property=headline>More <span class=tex>L<span class=raise>a</span>T<span class=drop>e</span>X</span> Hacking</h1><p class=post-meta><time datetime=2011-03-22T00:00:00+00:00 property=datePublished>Mar 22, 2011</time> • <span property=author typeof=Person><span property=name>Stephen Checkoway</span></span></div><div class=post-content property=articleBody><p>After I presented “<a href=/papers/tex2010>Are Text-Only Data Formats Safe? Or, Use This <span class=tex>L<span class=raise>a</span>T<span class=drop>e</span>X</span> Class File to Pwn Your Computer</a>” at LEET 2010, I was asked if I planned to do any more research on <span class=tex>T<span class=drop>e</span>X</span>. My answer was no. It was a fun little project to do but not really part of my Research Agenda<sup>TM</sup>. Imagine my surprise to find myself once again writing about <span class=tex>T<span class=drop>e</span>X</span> hacking.<p>One of the questions that came out of this project was could I, after performing all of the research into the internals of <span class=tex>L<span class=raise>a</span>T<span class=drop>e</span>X</span>, write a blacklist filter that would make embedding a preview service into a website safe. Publicly, my answer was no, but secretly, my answer was yes. <em>Of course I can do this</em>, I told myself. After all, there were just a few macros that really needed to be filtered out. I could prevent category code changes. I could leverage <span class=tex>T<span class=drop>e</span>X</span> itself to perform filtering. This would enable me to simply redefine the troublesome macros and primitives to be harmless. This isn’t a new idea, but I figured that <em>I</em> could do it correctly.<p>Ah hubris. Imagine my surprise to discover a new primitive in pdf<span class=tex>T<span class=drop>e</span>X</span> <code class="language-plaintext highlighter-rouge">\pdfprimitive</code> from the excellent <a href=http://tex.stackexchange.com/questions/13771/let-a-control-sequence-to-a-redefined-primitive>TeX-SX</a>. This primitive causes the following control sequence to have its primitive meaning, if it has one. For example, if <code class="language-plaintext highlighter-rouge">\input</code> has been redefined (e.g., to <code class="language-plaintext highlighter-rouge">\relax</code>), one can write <code class="language-plaintext highlighter-rouge">\pdfprimitive\input</code> to get the original meaning. I guess it is a good thing I never wrote such a blacklist.<p>I’m happy to say that our “promising approach” of using Web2C’s runtime configuration parameter <code class="language-plaintext highlighter-rouge">openin_any</code> still appears to be the best way to prevent data exfiltration.<p>So now that I know about <code class="language-plaintext highlighter-rouge">\pdfprimitive</code>, could I write a safe blacklist?</div><div class=post-footer><p class=post-meta>Last updated <time datetime=2011-03-22T00:00:00+00:00 property=dateModified>Mar 22, 2011</time>.</div></article></main>