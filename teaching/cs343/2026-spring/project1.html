<!DOCTYPE html><html lang=en><meta http-equiv=Content-Type content="text/html;charset=utf-8"> <meta http-equiv=X-UA-Compatible content="IE=edge"> <meta name=viewport content="width=device-width, initial-scale=1"><title>Project 1: Memory Safety</title><meta name=description content="Project 1: Memory Safety"> <link rel=canonical href=https://checkoway.net/teaching/cs343/2026-spring/project1.html> <link rel=stylesheet href=/css/main.css><main><h1 id=project-1-memory-safety>Project 1: Memory Safety</h1><p><strong>Due:</strong> 2026-03-01 at 23:59<h2 id=goal>Goal</h2><p>The goal of this assignment is to gain hands-on experience with the effect of buffer overflows and other memory-safety bugs.<p>All work in this project must be done in the QEMU virtual machine available <a href=https://cs.oberlin.edu/~steve/sandbox-4.0.tar.xz>here</a>; see below for information about this environment.<p>You are given a Python script <code class="language-plaintext highlighter-rouge">generate_targets.py</code> which, when run, will generate six vulnerable targets in a <code class="language-plaintext highlighter-rouge">targets</code> directory. The targets will be generated from an <code class="language-plaintext highlighter-rouge">ID</code> file that you must first fill out. See below for details.<p>These programs are to be compiled and installed, setuid root, in the <code class="language-plaintext highlighter-rouge">/targets</code> directory of your VM. After you run <code class="language-plaintext highlighter-rouge">generate_targets.py</code>, the created <code class="language-plaintext highlighter-rouge">targets</code> directory will contain a <code class="language-plaintext highlighter-rouge">Makefile</code>. You can build the target programs by running <code class="language-plaintext highlighter-rouge">make</code> in that directory. You can install the targets in the <code class="language-plaintext highlighter-rouge">/targets</code> directory by running <code class="language-plaintext highlighter-rouge">make install</code>.<p>Your goal is to write six exploit programs <code class="language-plaintext highlighter-rouge">exploit1.py</code>, …, <code class="language-plaintext highlighter-rouge">exploit6.py</code>, each of which will execute the corresponding target with input that exploits that target’s bug, giving a root shell on the VM.<p>I have provided skeletons for these exploits programs in the <code class="language-plaintext highlighter-rouge">exploits</code> directory. My own solutions, incidentally, are very short: fewer than 50 lines each. So while understanding and exploiting the bugs will not be easy, you will not need to write a lot of code.<h2 id=collaboration>Collaboration</h2><p>You may work on this project in groups of up to 3, although I recommend groups of size 2.<p>You must not discuss solutions to the project with anyone other than your partners and course staff. You may use online resources for general reference, but not to search for solutions to specific questions posed in this project.<h2 id=ai>AI</h2><p>Don’t use generative AI tools for any portion of the project, including identifying the vulnerabilities. Finding the vulnerabilities yourselves is a key part of this project.<h2 id=the-environment>The Environment</h2><p>You (and I, for grading) will run your exploit programs within a QEMU virtual machine. This virtual machine emulates a 64-bit x86 processor and has the latest version of Debian installed.<p>You should first install <a href=https://www.qemu.org/download/>QEMU</a>. (Select the appropriate operating system, don’t build it from source.)<p>Next, download and decompress <a href=https://cs.oberlin.edu/~steve/sandbox-4.0.tar.xz><code class="language-plaintext highlighter-rouge">sandbox-4.0.tar.xz</code></a>, if you have not already done so.<p>Inside the <code class="language-plaintext highlighter-rouge">sandbox-4.0</code> directory, you’ll find a script <code class="language-plaintext highlighter-rouge">start.sh</code>. Running that script will boot the VM. Read the <code class="language-plaintext highlighter-rouge">README.md</code> in the directory for details. If you’re using Windows, you’re on your own in terms of running the VM. Presumably you can create a PowerShell script to run <code class="language-plaintext highlighter-rouge">qemu-system-x86_64</code> with the appropriate options. (If you do do this, I’d love to see the script and add it to the sandbox for the next time this course is taught.)<p>You will need to configure Git inside the VM.<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>$ git config --global user.name "Your name here"
$ git config --global user.email "Your email here"
</code></pre></div></div><p>You’re now ready to clone the assignment repository.<p>The VM has a number of tools installed including the <code class="language-plaintext highlighter-rouge">gcc</code> compiler and <code class="language-plaintext highlighter-rouge">gdb</code> debugger. It has <code class="language-plaintext highlighter-rouge">vim</code>, <code class="language-plaintext highlighter-rouge">emacs</code>, and <code class="language-plaintext highlighter-rouge">neovim</code> installed. If you want to install additional tools such as other text editors, you may install them using <code class="language-plaintext highlighter-rouge">sudo apt install ...</code>.<p>The password for <code class="language-plaintext highlighter-rouge">user</code> is <code class="language-plaintext highlighter-rouge">user</code> and the password for <code class="language-plaintext highlighter-rouge">root</code> is <code class="language-plaintext highlighter-rouge">root</code>. You should do your work as <code class="language-plaintext highlighter-rouge">user</code>.<h2 id=the-assignment-repository>The Assignment Repository</h2><p>Go to the <a href=https://classroom.github.com/a/i3MdYwXZ>GitHub Classroom page</a> and accept the assignment.<ul><li>If you are working by yourself, create a new team (you can name it whatever you like).<li>If you are working with partners (which I recommend), one of you should create a new team and the other should join the team.</ul><p><strong>Warning: Do not join any team other than your partner’s. There’s no way to change teams for the assignment so just don’t do it! (If you do join the wrong team by mistake, let me know immediately.)</strong><p>You should now be able to clone the assignment repository in your VM using the <code class="language-plaintext highlighter-rouge">gh</code> command line tool (or via <code class="language-plaintext highlighter-rouge">git</code> directly although that’s less convenient).<h2 id=the-targets>The Targets</h2><p>Once you have cloned your assignment repository in the VM, you need to enter your name and your partners’ names in the <code class="language-plaintext highlighter-rouge">ID</code> file. If you’re working with partners, one of you should edit the <code class="language-plaintext highlighter-rouge">ID</code> file, commit it, and push it to GitHub. The other partner should <code class="language-plaintext highlighter-rouge">git pull</code> the change.<p>After you have done this, run<div class="language-sh highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=nv>$ </span>./generate_targets.py
</code></pre></div></div><p>to generate the <code class="language-plaintext highlighter-rouge">targets</code> directory.<p><strong>WARNING: Once you have generated the <code class="language-plaintext highlighter-rouge">targets</code> directory, any changes to your <code class="language-plaintext highlighter-rouge">ID</code> file at all will cause the <code class="language-plaintext highlighter-rouge">generate_targets.py</code> script to generate different targets and your exploits will likely not work when we’re grading.</strong><p>The <code class="language-plaintext highlighter-rouge">targets</code> directory contains the source code for the targets along with a <code class="language-plaintext highlighter-rouge">Makefile</code> specifying how they are to be built. To compile the targets and install them setuid root in <code class="language-plaintext highlighter-rouge">/targets</code>, use the commands <code class="language-plaintext highlighter-rouge">make</code> and <code class="language-plaintext highlighter-rouge">make install</code>. You will need to enter the password <code class="language-plaintext highlighter-rouge">user</code> at the prompt when you run <code class="language-plaintext highlighter-rouge">make install</code>.<p><code class="language-plaintext highlighter-rouge">target5</code> is fairly complicated. It reads commands for manipulating strings from the file specified as its argument. Due to the way <code class="language-plaintext highlighter-rouge">target5</code> is compiled, the glibc <code class="language-plaintext highlighter-rouge">malloc</code>/<code class="language-plaintext highlighter-rouge">free</code>/<code class="language-plaintext highlighter-rouge">realloc</code> functions are not used. Instead, the replacement functions in <code class="language-plaintext highlighter-rouge">smalloc.c</code> are called. You should be able to set breakpoints inside those functions in the debugger as normal.<p>Do not commit the <code class="language-plaintext highlighter-rouge">targets</code> directory. For grading, I will run the <code class="language-plaintext highlighter-rouge">generate_targets.py</code> script and run your exploits against those targets.<h2 id=the-exploits>The Exploits</h2><p>The <code class="language-plaintext highlighter-rouge">exploits</code> directory in the assignment contains skeleton source for the exploits which you are to write.<p>Your exploits should assume that the compiled target programs are installed in <code class="language-plaintext highlighter-rouge">/targets</code>—<code class="language-plaintext highlighter-rouge">/targets/target1</code>, …, <code class="language-plaintext highlighter-rouge">/targets/target6</code>.<h2 id=the-assignment>The Assignment</h2><p>You are to write exploits, one per target. Each exploit, when run in the virtual machine with its target installed setuid-root in <code class="language-plaintext highlighter-rouge">/targets</code>, should yield a root shell (<code class="language-plaintext highlighter-rouge">/bin/sh</code>).<p>In addition to the exploits, you should edit the <code class="language-plaintext highlighter-rouge">writeup.md</code> file and explain for each target that you exploit,<ol><li>what the vulnerability is;<li>what technique you used to exploit the vulnerability; and<li>how you used that technique to exploit the vulnerability.</ol><h2 id=hints>Hints</h2><ul><li>Read Aleph One’s “Smashing the Stack for Fun and Profit,” carefully! Also, read the “suggested reading” listed in the project <code class="language-plaintext highlighter-rouge">README.md</code>. You will want to have a good understanding of what happens to the stack, program counter, and relevant registers before and after a function call. Read scut’s “Exploiting Format String Vulnerabilities.” It will be helpful to have a solid understanding of the basic buffer overflow exploits before reading the more advanced exploit papers.<li>The GDB debugger is your best friend in this assignment as you’ll want to understand what’s going on in the target program’s memory space. Specifically, note the <code class="language-plaintext highlighter-rouge">disassemble</code>, <code class="language-plaintext highlighter-rouge">stepi</code>, and <code class="language-plaintext highlighter-rouge">nexti</code> commands. You may find the <code class="language-plaintext highlighter-rouge">x</code> command useful to examine memory (and the different ways you can print the contents such as <code class="language-plaintext highlighter-rouge">/a</code> or <code class="language-plaintext highlighter-rouge">/i</code> after <code class="language-plaintext highlighter-rouge">x</code>). The <code class="language-plaintext highlighter-rouge">info register</code> command is helpful for printing out the contents of registers.<li><p>A useful way to run GDB is to use the <code class="language-plaintext highlighter-rouge">-e</code> and <code class="language-plaintext highlighter-rouge">-s</code> command line flags; for example, the command<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>gdb -e python3 -s /targets/target3 
</code></pre></div></div><p>tells GDB to execute <code class="language-plaintext highlighter-rouge">python3</code> and use the symbols from <code class="language-plaintext highlighter-rouge">target3</code>. Once GDB has started, you can use the GDB command <code class="language-plaintext highlighter-rouge">run exploit3.py</code> to run your exploit. This allows you to trace execution in the target in exactly the way it is executed by the exploit. By contrast, executing just <code class="language-plaintext highlighter-rouge">gdb /targets/target3</code> will trace the target in the way it is executed by the shell, so the memory layout will be different. (Avoiding a segfault while using this requires careful timing in setting breakpoints. See the assignment <code class="language-plaintext highlighter-rouge">README.md</code> for the details.)<li>One of the projects is very constrained in what arguments can be passed to it and you may have trouble running code on the heap (i.e., memory allocated by <code class="language-plaintext highlighter-rouge">malloc</code>). Try placing the shellcode somewhere else.<li>Make sure that your exploits work within the provided virtual machine.<li>Start early! Theoretical knowledge of exploits does not readily translate into the ability to write working exploits. The first target is relatively simple to exploit, but the difficulty ramps up from there.</ul><h2 id=warnings>Warnings</h2><p>Aleph One gives code that calculates addresses on the target’s stack based on addresses on the exploit program’s stack. Since your exploits are written in Python, you don’t have access to this information. This is good since you shouldn’t rely on it anyway.<p>You must, therefore, hard-code target stack locations in your exploits. You should <em>not</em> use a function such as <code class="language-plaintext highlighter-rouge">get_sp</code> in the exploits you hand in.<h2 id=deliverables>Deliverables</h2><ul><li>You will submit by committing your code and pushing to GitHub.<li>Make sure you’ve explained how everything works in the <code class="language-plaintext highlighter-rouge">writeup.md</code> file. Feel free to use Markdown formatting.<li>Finally, you must include the file <code class="language-plaintext highlighter-rouge">ID</code> which contains the names of all partners (or just your own if you worked by yourself). Heed the warning about changing <code class="language-plaintext highlighter-rouge">ID</code> <a href=#the-targets>above</a>!</ul></main>