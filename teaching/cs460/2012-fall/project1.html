<!DOCTYPE html><html lang=en><meta http-equiv=Content-Type content="text/html;charset=utf-8"> <meta name=viewport content="width=device-width, initial-scale=1"> <link rel=stylesheet href=/css/old-teaching.css type=text/css><title>Project 1</title><div id=layout-content><div id=toptitle><div id=title>Project 1</div></div><p><b>Part 1 due:</b> Thursday, September 12, 2013, 23:59<br><b>Part 2 due:</b> Tuesday, September 24, 2013, 23:59<h2>Goal</h2><p>The goal of this assignment is to gain hands-on experience with the effect of buffer overflows and other memory-safety bugs.<p>All work in this project must be done on the VirtualBox virtual machine provided on the course website; see below for information about this environment.<p>You are given, in the <code>targets</code> directory, the source code for six exploitable programs, <code>target1.c</code>, …, <code>target5.c</code>, and <code>target6.cc</code>. These programs are to be compiled and installed, setuid root, in the /tmp directory of your VM. Your goal is to write six exploit programs <code>sploit1</code>, …, <code>sploit6</code>, each of which will execute the corresponding target with input that exploits that target's bug, giving a root shell on the VM.<p>We have provided skeletons for these exploits programs in the <code>sploits</code> directory, as <code>sploit1.c</code>, …, <code>sploit6.c</code>. Our own solutions, incidentally, are very short: fewer than 50 lines each. So while understanding and exploiting the bugs will not be easy, you will not need to write a lot of code.<h2>Collaboration</h2><p>You may work on this project with one other person (and this is encouraged). You will turn in a single set of solutions together, but it is expected that both of you understand and can explain how to exploit each target. You must not discuss the project with anyone in the class besides your partner, nor with anyone outside of class. This includes discussing what particular vulnerabilities in the targets are! You may use online resources for general reference, but not to search for solutions to specific questions posed in this project.<h2>The Environment</h2><p>You (and we, for grading) will test your exploit programs within a VirtualBox virtual machine. To use this VM on your personal computer (Windows, Mac OS X, and Linux are supported), you will need to download the virtual machine image provided on the course website — sandbox-1.0.tar.bz2 — as well as VirtualBox from the <a href=https://www.virtualbox.org/wiki/Downloads>VirtualBox website</a>.<p>We have also arranged for VirtualBox to be installed on the Windows machines in Maryland 310.<p>The VM has Debian Stable installed as well as a number of useful utilities such as vim, ssh, and wget.<h2>The Targets</h2><p>The <code>targets</code> directory in the assignment tarball contains the source code for the targets along with a <code>Makefile</code> specifying how they are to be built. To compile the targets and install them setuid root in <code>/tmp</code>, use the commands <code>make</code> and <code>make install</code>.<p>Your exploits should assume that the compiled target programs are installed in <code>/tmp</code> — <code>/tmp/target1</code>, …, <code>/tmp/target6</code>.<h2>The Exploits</h2><p>The <code>sploits</code> directory in the assignment tarball contains skeleton source for the exploits which you are to write, along with a <code>Makefile</code> for building them. Also included is <code>shellcode.h</code>, which contains Aleph One's shellcode.<p>Along with each exploit skeleton file, there is an empty text file that you should fill with an explanation of the bug in the corresponding target and how your exploit takes advantage of it. You will submit this explanation along with your exploit.<h2>The Assignment</h2><p>You are to write exploits, one per target. Each exploit, when run in the virtual machine with its target installed setuid-root in <code>/tmp</code>, should yield a root shell (<code>/bin/sh</code>).<h2>Hints</h2><ol><li><p>Read Aleph One's “Smashing the Stack for Fun and Profit,” carefully! Also, read the “suggested reading” listed in the project <code>README</code>. You will want to have a good understanding of what happens to the stack, program counter, and relevant registers before and after a function call. Read scut's “Exploiting Format String Vulnerabilities.” It will be helpful to have a solid understanding of the basic buffer overflow exploits before reading the more advanced exploit papers.<li><p>The <code>gdb</code> debugger is your best friend in this assignment as you'll want to understand what's going on in the target program's memory space. Specifically, note the <code>disassemble</code> and <code>stepi</code> commands. You may find the <code>x</code> command useful to examine memory (and the different ways you can print the contents such as <code>/a</code> or <code>/i</code> after <code>x</code>). The <code>info register</code> command is helpful for printing out the contents of registers.<li><p>A useful way to run <code>gdb</code> is to use the <code>-e</code> and <code>-s</code> command line flags; for example, the command <code>gdb -e ./sploit3 -s /tmp/target3</code> tells <code>gdb</code> to execute <code>sploit3</code> and use the symbols from <code>target3</code> which allows you to trace execution in the target in exactly the way it is executed by the exploit. By contrast, executing just <code>gdb /tmp/target3</code> will trace the target in the way it is executed by the shell, so the memory layout will be different. (Avoiding a segfault while using this requires careful timing in setting breakpoints. See the assignment <code>README</code> for the details.)<li><p>Make sure that your exploits work within the provided virtual machine.<li><p>Start early! Theoretical knowledge of exploits does not readily translate into the ability to write working exploits. The first target is relatively simple to exploit, but the difficulty ramps up from there.</ol><h2>Warnings</h2><p>Aleph One gives code that calculates addresses on the target's stack based on addresses on the exploit's stack. Addresses on the exploit's stack can be changed based on how the exploit is executed (working directory, arguments, environment, etc.); in our testing, we do not guarantee to execute your exploits the same way <code>bash</code> does.<p>You must, therefore, hard-code target stack locations in your exploits. You should <i>not</i> use a function such as <code>get_sp</code> in the exploits you hand in.<h2>Deliverables</h2><p>To encourage you to start on the project early, part 1 consists of <code>target1</code> and <code>target2</code>. Part 2, due a little later consists of the other four targets.<p>You are to provide a tarball (i.e., a <code>.tar.gz</code> or <code>.tar.bz2</code> file) containing the source files, the <code>Makefile</code> for building your exploits, and the text files <code>sploit1.txt</code>, …, <code>sploit6.txt</code> as described above. All of the exploits should build if the <code>make</code> command is issued.<p>There should be <b>no</b> directory structure: all files in the tarball should be in its root directory. (Run <code>tar</code> from inside the <code>sploits</code> directory.)<p>Finally, you must include a file called <code>ID</code> which contains the names of both partners (or just your own if you worked by yourself).<h2>Setting up the Environment</h2><p>On your own machine, you will need to install VirtualBox. Follow the instructions on the <a href=https://www.virtualbox.org/wiki/Downloads>VirtualBox webpage</a>. If you have trouble, read the documentation.<ol><li><p>Download the VM (sandbox-1.0.tar.bz2) and decompress it.<li><p>From the <code>Machine</code> menu, choose the <code>Add…</code> menu option.<li><p>Navigate the open dialog box to the <code>sandbox-1.0</code> directory and open <code>sandbox.vbox</code>.<li><p>In the main window, select the <code>sandbox</code> VM and start it by clicking on the <code>Start</code> button.<li><p>Log in to the VM. There are two accounts, <code>root</code> with password <code>root</code> and <code>user</code> with the password <code>user</code>. The <code>user</code> account can use the <code>sudo</code> command to run commands as root (or <code>sudo -s</code> to get a root shell).<li><p>Download the project 1 tarball in the virtual machine.<br><code>wget https://www.cs.jhu.edu/~s/teaching/cs460/2012-fall/project1.tar.gz</code><li><p>Unpack <code>project1.tar.gz</code> and use the <code>Makefile</code> to build and install the targets.<li><p>If you reboot the VM, you'll have to reinstall the targets because the <code>/tmp</code> directory will have been wiped clean.</ol><div id=footer><div id=footer-text>Last updated 2016-06-28 11:48:44 CDT.</div></div></div>