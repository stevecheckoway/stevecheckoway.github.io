<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/old-teaching.css" type="text/css" />
<title>Project 1</title>
</head>
<body>
<div id="layout-content">
<div id="toptitle">
<div id="title">Project 1</div>
</div>
<p><b>Part 1 due:</b> Thursday, September 12, 2013, 23:59<br />
<b>Part 2 due:</b> Tuesday, September 24, 2013, 23:59</p>
<h2>Goal</h2>
<p>The goal of this assignment is to gain hands-on experience with the effect of
buffer overflows and other memory-safety bugs.</p>
<p>All work in this project must be done on the VirtualBox virtual machine
provided on the course website; see below for information about this
environment.</p>
<p>You are given, in the <tt>targets</tt> directory, the source code for six
exploitable programs, <tt>target1.c</tt>, &hellip;, <tt>target5.c</tt>, and <tt>target6.cc</tt>.
These programs are to be compiled and installed, setuid root, in the
/tmp directory of your VM. Your goal is to write six exploit programs
<tt>sploit1</tt>, &hellip;, <tt>sploit6</tt>, each of which will execute the
corresponding target with input that exploits that target's bug,
giving a root shell on the VM.</p>
<p>We have provided skeletons for these exploits programs in the
<tt>sploits</tt> directory, as <tt>sploit1.c</tt>, &hellip;, <tt>sploit6.c</tt>. Our own
solutions, incidentally, are very short: fewer than 50 lines each. So
while understanding and exploiting the bugs will not be easy, you will
not need to write a lot of code.</p>
<h2>Collaboration</h2>
<p>You may work on this project with one other person (and this is
encouraged). You will turn in a single set of solutions together, but
it is expected that both of you understand and can explain how to
exploit each target. You must not discuss the project with anyone in
the class besides your partner, nor with anyone outside of class. This
includes discussing what particular vulnerabilities in the targets
are! You may use online resources for general reference, but not to
search for solutions to specific questions posed in this project.</p>
<h2>The Environment</h2>
<p>You (and we, for grading) will test your exploit programs within a
VirtualBox virtual machine. To use this VM on your personal computer
(Windows, Mac OS X, and Linux are supported), you will need to
download the virtual machine image provided on the course
website&#8201;&mdash;&#8201;sandbox-1.0.tar.bz2&#8201;&mdash;&#8201;as well as
VirtualBox from the <a href="https://www.virtualbox.org/wiki/Downloads">VirtualBox website</a>.</p>
<p>We have also arranged for VirtualBox to be installed on the Windows
machines in Maryland 310.</p>
<p>The VM has Debian Stable installed as well as a number of useful
utilities such as vim, ssh, and wget.</p>
<h2>The Targets</h2>
<p>The <tt>targets</tt> directory in the assignment tarball contains the source
code for the targets along with a <tt>Makefile</tt> specifying how they are
to be built. To compile the targets and install them setuid root in
<tt>/tmp</tt>, use the commands <tt>make</tt> and <tt>make install</tt>.</p>
<p>Your exploits should assume that the compiled target programs are
installed in <tt>/tmp</tt>&#8201;&mdash;&#8201;<tt>/tmp/target1</tt>, &hellip;, <tt>/tmp/target6</tt>.</p>
<h2>The Exploits</h2>
<p>The <tt>sploits</tt> directory in the assignment tarball contains skeleton
source for the exploits which you are to write, along with a
<tt>Makefile</tt> for building them. Also included is <tt>shellcode.h</tt>, which
contains Aleph One's shellcode.</p>
<p>Along with each exploit skeleton file, there is an empty text file
that you should fill with an explanation of the bug in the
corresponding target and how your exploit takes advantage of it. You
will submit this explanation along with your exploit.</p>
<h2>The Assignment</h2>
<p>You are to write exploits, one per target. Each exploit, when run in
the virtual machine with its target installed setuid-root in <tt>/tmp</tt>,
should yield a root shell (<tt>/bin/sh</tt>).</p>
<h2>Hints</h2>
<ol>
<li><p>Read Aleph One's &ldquo;Smashing the Stack for Fun and Profit,&rdquo; carefully!
Also, read the &ldquo;suggested reading&rdquo; listed in the project <tt>README</tt>.
You will want to have a good understanding of what happens to the
stack, program counter, and relevant registers before and after a
function call. Read scut's &ldquo;Exploiting Format String
Vulnerabilities.&rdquo; It will be helpful to have a solid understanding
of the basic buffer overflow exploits before reading the more
advanced exploit papers.</p>
</li>
<li><p>The <tt>gdb</tt> debugger is your best friend in this assignment as you'll
want to understand what's going on in the target program's memory
space. Specifically, note the <tt>disassemble</tt> and <tt>stepi</tt> commands.
You may find the <tt>x</tt> command useful to examine memory (and the
different ways you can print the contents such as <tt>/a</tt> or <tt>/i</tt>
after <tt>x</tt>). The <tt>info register</tt> command is helpful for printing out
the contents of registers.</p>
</li>
<li><p>A useful way to run <tt>gdb</tt> is to use the <tt>-e</tt> and <tt>-s</tt> command line
flags; for example, the command
<tt>gdb -e ./sploit3 -s /tmp/target3</tt> 
tells <tt>gdb</tt> to execute <tt>sploit3</tt> and use the symbols from <tt>target3</tt>
which allows you to trace execution in the target in exactly the way
it is executed by the exploit. By contrast, executing just
<tt>gdb /tmp/target3</tt> will trace the target in the way it is executed
by the shell, so the memory layout will be different. (Avoiding a
segfault while using this requires careful timing in setting
breakpoints. See the assignment <tt>README</tt> for the details.)</p>
</li>
<li><p>Make sure that your exploits work within the provided virtual
machine.</p>
</li>
<li><p>Start early! Theoretical knowledge of exploits does not readily
translate into the ability to write working exploits. The first
target is relatively simple to exploit, but the difficulty ramps up
from there.</p>
</li>
</ol>
<h2>Warnings</h2>
<p>Aleph One gives code that calculates addresses on the target's stack
based on addresses on the exploit's stack. Addresses on the exploit's
stack can be changed based on how the exploit is executed (working
directory, arguments, environment, etc.); in our testing, we do not
guarantee to execute your exploits the same way <tt>bash</tt> does.</p>
<p>You must, therefore, hard-code target stack locations in your
exploits. You should <i>not</i> use a function such as <tt>get_sp</tt> in the
exploits you hand in.</p>
<h2>Deliverables</h2>
<p>To encourage you to start on the project early, part 1 consists of
<tt>target1</tt> and <tt>target2</tt>. Part 2, due a little later consists of the
other four targets.</p>
<p>You are to provide a tarball (i.e., a <tt>.tar.gz</tt> or <tt>.tar.bz2</tt> file)
containing the source files, the <tt>Makefile</tt> for building your
exploits, and the text files <tt>sploit1.txt</tt>, &hellip;, <tt>sploit6.txt</tt> as
described above. All of the exploits should build if the <tt>make</tt>
command is issued.</p>
<p>There should be <b>no</b> directory structure: all files in the tarball
should be in its root directory. (Run <tt>tar</tt> from inside the <tt>sploits</tt>
directory.)</p>
<p>Finally, you must include a file called <tt>ID</tt> which contains the names
of both partners (or just your own if you worked by yourself).</p>
<h2>Setting up the Environment</h2>
<p>On your own machine, you will need to install VirtualBox. Follow the
instructions on the <a href="https://www.virtualbox.org/wiki/Downloads">VirtualBox webpage</a>. If you have trouble, read the documentation.</p>
<ol>
<li><p>Download the VM (sandbox-1.0.tar.bz2) and
decompress it.</p>
</li>
<li><p>From the <tt>Machine</tt> menu, choose the <tt>Add&hellip;</tt> menu option.</p>
</li>
<li><p>Navigate the open dialog box to the <tt>sandbox-1.0</tt> directory and
open <tt>sandbox.vbox</tt>.</p>
</li>
<li><p>In the main window, select the <tt>sandbox</tt> VM and start it by clicking
on the <tt>Start</tt> button.</p>
</li>
<li><p>Log in to the VM. There are two accounts, <tt>root</tt> with password
<tt>root</tt> and <tt>user</tt> with the password <tt>user</tt>. The <tt>user</tt> account can
use the <tt>sudo</tt> command to run commands as root (or <tt>sudo -s</tt> to get
a root shell).</p>
</li>
<li><p>Download the project 1 tarball in the virtual machine.<br />
<tt>wget https://www.cs.jhu.edu/~s/teaching/cs460/2012-fall/project1.tar.gz</tt></p>
</li>
<li><p>Unpack <tt>project1.tar.gz</tt> and use the <tt>Makefile</tt> to build and install
the targets.</p>
</li>
<li><p>If you reboot the VM, you'll have to reinstall the targets because
the <tt>/tmp</tt> directory will have been wiped clean.</p>
</li>
</ol>
<div id="footer">
<div id="footer-text">
Last updated 2016-06-28 11:48:44 CDT.
</div>
</div>
</div>
</body>
</html>
