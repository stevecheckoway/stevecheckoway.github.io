<!DOCTYPE html><html lang=en><meta http-equiv=Content-Type content="text/html;charset=utf-8"> <meta http-equiv=X-UA-Compatible content="IE=edge"> <meta name=viewport content="width=device-width, initial-scale=1"><title>Lecture 11</title><meta name=description content="Lecture 11 – Feb 26th, 2020"> <link rel=canonical href=https://checkoway.net/teaching/cs241/2020-spring/exercises/Lecture-11.html> <link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.css integrity=sha384-TEMocfGvRuD1rIAacqrknm5BQZ7W7uWitoih+jMNFXQIbNl16bO8OZmylH/Vi/Ei crossorigin=anonymous> <link rel=stylesheet href=/css/main.css><main><h1 id=lecture-11--feb-26th-2020>Lecture 11 – Feb 26th, 2020</h1><h2 id=setup>Setup</h2><ol><li>Log in to clyde.<li>Create a directory and <code class="language-plaintext highlighter-rouge">cd</code> into it.<li>Copy <code class="language-plaintext highlighter-rouge">~steve/ex/mc_pi.c</code>, <code class="language-plaintext highlighter-rouge">~steve/ex/logger.h</code>, <code class="language-plaintext highlighter-rouge">~steve/ex/logger.c</code>, <code class="language-plaintext highlighter-rouge">~steve/ex/rand.h</code> and <code class="language-plaintext highlighter-rouge">~steve/ex/rand.c</code> into the directory.</ol><h2 id=task>Task</h2><ol><li><p>Based on the example Makefile in the <a href=../slides/Lecture-11-Make-and-Compiling.pdf>slides</a>, create a <code class="language-plaintext highlighter-rouge">Makefile</code> to compile the program <code class="language-plaintext highlighter-rouge">mc_pi</code>. Make sure you look through each <code class="language-plaintext highlighter-rouge">.c</code> file to see which <code class="language-plaintext highlighter-rouge">.h</code> files it includes so you can set up the prerequisites correctly.<p>If you have put <code class="language-plaintext highlighter-rouge">-std=c11</code> in the <code class="language-plaintext highlighter-rouge">CFLAGS</code> variable (and you should), you’ll get an error and a warning like this.<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>mc_pi.c:49:18: warning: implicit declaration of function 'getopt' is invalid in C99 [-Wimplicit-function-declaration]
  while ((flag = getopt(argc, argv, "hn:v")) != -1) {
                 ^
mc_pi.c:52:21: error: use of undeclared identifier 'optarg'
      trials = atoi(optarg);
                    ^
1 warning and 1 error generated.
</code></pre></div></div><p>To fix that, add <code class="language-plaintext highlighter-rouge">-D_POSIX_C_SOURCE=200809L</code> to <code class="language-plaintext highlighter-rouge">CFLAGS</code>.<p>When you run <code class="language-plaintext highlighter-rouge">$ make</code>, it should build three object files (those ending in <code class="language-plaintext highlighter-rouge">.o</code>) and the program <code class="language-plaintext highlighter-rouge">mc_pi</code>.<li>Run <code class="language-plaintext highlighter-rouge">$ ./mc_pi</code> a few times to see what it does. Run <code class="language-plaintext highlighter-rouge">$ ./mc_pi -h</code> to get the help. Run <code class="language-plaintext highlighter-rouge">mc_pi</code> again but change the number of trials. Try small values and large values. Try nonsensical values (or no value at all).<li><p>The <code class="language-plaintext highlighter-rouge">touch</code> command can be used to change the time stamp on a file without changing any of its contents. We can use this to test the <code class="language-plaintext highlighter-rouge">Makefile</code>.<p>First, run <code class="language-plaintext highlighter-rouge">$ make</code> again. If you haven’t changed any files, <code class="language-plaintext highlighter-rouge">make</code> should say it has nothing to do. Next, run <code class="language-plaintext highlighter-rouge">$ touch logger.c</code> and then rerun <code class="language-plaintext highlighter-rouge">make</code>. If everything worked correctly with your <code class="language-plaintext highlighter-rouge">Makefile</code>, <code class="language-plaintext highlighter-rouge">logger.o</code> and <code class="language-plaintext highlighter-rouge">mc_pi</code> should be remade but nothing else.<li>Run <code class="language-plaintext highlighter-rouge">touch</code> on <code class="language-plaintext highlighter-rouge">rand.h</code> and rerun <code class="language-plaintext highlighter-rouge">make</code>. Did it rebuild the right files?<li><p>If you didn’t do so in step 1, add phony <code class="language-plaintext highlighter-rouge">all</code> and <code class="language-plaintext highlighter-rouge">clean</code> targets. <code class="language-plaintext highlighter-rouge">all</code> should depend on <code class="language-plaintext highlighter-rouge">mc_pi</code> and have no recipe. <code class="language-plaintext highlighter-rouge">clean</code> shouldn’t depend on anything but should remove <code class="language-plaintext highlighter-rouge">mc_pi</code> and the object files. Make sure you don’t delete your source files!<p>Remember, <code class="language-plaintext highlighter-rouge">all</code> should be the first target in the <code class="language-plaintext highlighter-rouge">Makefile</code>. Running <code class="language-plaintext highlighter-rouge">$ make</code> and <code class="language-plaintext highlighter-rouge">$ make all</code> should have the same effect. Test that <code class="language-plaintext highlighter-rouge">$ make clean</code> performs the correct action.<p>Recall that to make a phony target, you add it as a prerequisite to the <code class="language-plaintext highlighter-rouge">.PHONY</code> so you should have the line<div class="language-make highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=nl>.PHONY</span><span class=o>:</span> <span class=nf>all clean</span>
</code></pre></div></div><li>Remove <code class="language-plaintext highlighter-rouge">clean</code> from the <code class="language-plaintext highlighter-rouge">.PHONY: all clean</code> line of the <code class="language-plaintext highlighter-rouge">Makefile</code>. Run <code class="language-plaintext highlighter-rouge">$ touch clean</code>. This will create an empty file named <code class="language-plaintext highlighter-rouge">clean</code>. Run <code class="language-plaintext highlighter-rouge">$ make clean</code> and note what happens.<li>Readd <code class="language-plaintext highlighter-rouge">clean</code> to <code class="language-plaintext highlighter-rouge">.PHONY:</code> and run <code class="language-plaintext highlighter-rouge">$ make clean</code> again. It should perform the clean action even though the <code class="language-plaintext highlighter-rouge">clean</code> file is present. Remove the <code class="language-plaintext highlighter-rouge">clean</code> file.<li><p>Add logging to <code class="language-plaintext highlighter-rouge">rand.c</code> to log (with <code class="language-plaintext highlighter-rouge">LOG_LEVEL_INFO</code>) each random value that is produced. <code class="language-plaintext highlighter-rouge">log_message</code> takes a variable number of arguments where the first one is the log level, the second is a printf-style format string, and the remaining are the arguments to print according to the format string’s conversion specifiers. You can use <code class="language-plaintext highlighter-rouge">%f</code> to print out the double.<p>Make sure you include the appropriate header <em>and</em> update the dependencies in your <code class="language-plaintext highlighter-rouge">Makefile</code>.<li>Run <code class="language-plaintext highlighter-rouge">mc_pi</code> with the <code class="language-plaintext highlighter-rouge">-v</code> argument. You might want to have just a few trials to avoid spamming your terminal with a few hundred random values. You can also redirect the messages to a file using <code class="language-plaintext highlighter-rouge">$ ./mc_pi -v -n 1000 2&gt;generated_files</code>.</ol></main>