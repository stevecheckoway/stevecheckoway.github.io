I"ìT<h1 id="homework-3-strings">Homework 3: Strings</h1>
<p><strong>Due: TBD at 23:59</strong></p>

<h2 id="preliminaries">Preliminaries</h2>
<p>First, find a partner. You‚Äôre allowed to work by yourself, but I highly
recommend working with a partner. Click on the <a href="">assignment
link</a>. One partner should create a
new team. The second partner should click the link and choose the appropriate
team. (Please don‚Äôt choose the wrong team, there‚Äôs a maximum of two people and
if you join the wrong one, you‚Äôll prevent the correct person from joining.)</p>

<p>Once you have accepted the assignment and created/joined a team, you can clone
the repository on clyde and begin working. But before you do, read the entire
assignment and be sure to check out the expected <a href="#coding-style">coding style</a>.</p>

<p>Be sure to ask any questions on
<a href="">Piazza</a>.</p>

<h3 id="coding-style">Coding style</h3>
<p>See <a href="hw2.html#coding-style">homework 2‚Äôs coding style</a>.</p>

<p>You should run <code class="highlighter-rouge">clang-format</code> on each of the C source and header files you
write. This will format all of your files consistently.</p>

<h3 id="code-warnings-and-errors">Code warnings and errors</h3>
<p>Your code must compile without error or warning when compiled with <code class="highlighter-rouge">-std=c11
-Wall</code>.</p>

<p>Additionally, for this assignment, you need to compile and link your code with
<code class="highlighter-rouge">-fsanitize=address,undefined</code>. To do this, we need to make some changes
to your <code class="highlighter-rouge">Makefile</code> rules. Take a look in the skeleton <code class="highlighter-rouge">Makefile</code> provided with
the assignment code.</p>

<p>Notice how there is a new variable <code class="highlighter-rouge">LDFLAGS</code>. This is where flags passed to the
linker go. Since <code class="highlighter-rouge">-fsanitize=address,undefined</code> need to be passed to both the
compiler and to the linker, we include them in both <code class="highlighter-rouge">CFLAGS</code> and <code class="highlighter-rouge">LDFLAGS</code>.
The rule to compile binaries now</p>
<div class="language-make highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">foo</span><span class="o">:</span> <span class="nf">a.o b.o c.o</span>
        <span class="err">$(CC)</span> <span class="err">$(LDFLAGS)</span> <span class="err">-o</span> <span class="err">$@</span> <span class="err">$^</span>
</code></pre></div></div>

<h3 id="submission">Submission</h3>
<p>To submit your homework, you must commit and push to GitHub before the
deadline.</p>

<p>Your repository should contain the following files</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚îú‚îÄ‚îÄ Makefile
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ tests
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ common.sh
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ run_tests
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ test_caesar
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ test_help
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ test_pig
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ test_reverse
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ test_shouty
‚îî‚îÄ‚îÄ wordmod.c
</code></pre></div></div>

<p>It may also a <a href="https://git-scm.com/docs/gitignore"><code class="highlighter-rouge">.gitignore</code></a> file which
tells Git to ignore files matching patterns in your working directory (like
<code class="highlighter-rouge">*.o</code>, for example).</p>

<p>You may also split your implementation of <code class="highlighter-rouge">wordmod</code> into multiple source and
header files. These should also be included in your repository.</p>

<p>Any additional files you have added to your repository should be removed from
the <code class="highlighter-rouge">master</code> branch. (You‚Äôre free to make other branches, if you desire, but
make sure <code class="highlighter-rouge">master</code> contains the version of the code you want graded.)</p>

<p>The <code class="highlighter-rouge">README.md</code> should contain</p>
<ul>
  <li>An image link showing the Travis CI build status (see part 0)</li>
  <li>The names of both partners (or just your name if you worked alone‚Ä¶but</li>
  <li>please don‚Äôt work alone if you can manage it).</li>
  <li>An estimate of the amount of time it took to complete each program.</li>
  <li>Any known bugs or incomplete functions.</li>
  <li>Any interesting design decisions you‚Äôd like to share.</li>
</ul>

<p>Each of your source files with a <code class="highlighter-rouge">main</code> function should contain a comment at the top of the file
that contains usage information plus a description of what the program does.</p>

<p>Example.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Usage: ./wordmod [OPTIONS]</span>
<span class="c1">// </span>
<span class="c1">// Wordmod will ...</span>
</code></pre></div></div>

<h2 id="part-0-makefile-testing-and-travis-ci">Part 0. Makefile, testing, and Travis CI</h2>
<h3 id="makefile">Makefile</h3>
<p>The assignment code comes with a bare-bones <code class="highlighter-rouge">Makefile</code>. You need to expand
upon it as you work through the following parts. Use a pattern rule to compile
<code class="highlighter-rouge">.o</code> files from the corresponding <code class="highlighter-rouge">.c</code> files. Make sure each <code class="highlighter-rouge">.o</code> file depends
on the appropriate header files and each program you write depends on the
appropriate <code class="highlighter-rouge">.o</code> files.</p>

<p>The <code class="highlighter-rouge">all</code> target should depend on all of the programs you write.</p>

<p>The <code class="highlighter-rouge">clean</code> target should delete all of the programs you write and all of the
object files. (Using <code class="highlighter-rouge">*.o</code> in <code class="highlighter-rouge">clean</code> is perfectly acceptable.)</p>

<h3 id="testing">Testing</h3>
<p>The assignment code also comes with a set of testing scripts in the <code class="highlighter-rouge">tests</code>
directory. You can run them by running <code class="highlighter-rouge">$ make check</code>.</p>

<p>There are a handful of tests in the testing directory. You need to write more
tests to test the functionality of each part.</p>

<p>As you work through the parts below, run <code class="highlighter-rouge">$ make check</code> frequently to make
sure that you haven‚Äôt broken any code you previously had working.</p>

<h3 id="travis-ci">Travis CI</h3>
<p>This homework also uses the <a href="https://travis-ci.com/">Travis CI</a> continuous
integration service. Each time you push your code to GitHub, Travis will
download the latest version, build your program and then run the tests.</p>

<p>You should be able to see the status of your latest commit by logging in to
<a href="https://travis-ci.com">Travis CI</a> using your GitHub account. You can also see
the latest status from Travis by clicking on the <code class="highlighter-rouge">1 branch</code> link near the top
of the GitHub page for your repository which has URL
<code class="highlighter-rouge">https://github.com/systems-programming/${repo_name}/branches</code>. You should see
either a green check mark if all tests passed or a red X if one or more tests
failed.</p>

<p>You should add a build status image to your <code class="highlighter-rouge">README.md</code> by following the
<a href="https://docs.travis-ci.com/user/status-images/">instructions</a> to get the
Markdown code to paste into <code class="highlighter-rouge">README.md</code>.</p>

<h2 id="part-1-overview-and-command-line-arguments">Part 1. Overview and command line arguments</h2>
<p>In this assignment, you will write a program called <code class="highlighter-rouge">wordmod</code> that will
perform a variety of modifications to words read from <code class="highlighter-rouge">stdin</code> and written to
<code class="highlighter-rouge">stdout</code>. The choice of modification will be controlled by command line flags.</p>

<p>The basic flow of <code class="highlighter-rouge">wordmod</code> should be the following.</p>
<ol>
  <li>Use <code class="highlighter-rouge">getopt(3)</code> to parse command line arguments and determine which
transformation, if any, is to be applied to the input.</li>
  <li>In a loop,
    <ol>
      <li>Read in and print any characters that do not form part of a word;</li>
      <li>Read in a word of up to 45 characters;</li>
      <li>Perform the requested transformation by calling an appropriate function
on the just-read word; and</li>
      <li>Print the transformed word.</li>
    </ol>
  </li>
</ol>

<p>There should be a command line option for each transformation described in the
subsequent parts. In addition, <code class="highlighter-rouge">-h</code> should print out a help message with usage
information and exit with exit value 0. Any unknown options should cause the
help message and usage information to be printed and exit with exit value 0.
(<code class="highlighter-rouge">getopt()</code> itself will print a message about invalid options.) As usual,
error messages should go to <code class="highlighter-rouge">stderr</code> and normal output should go to <code class="highlighter-rouge">stdout</code>.
(<code class="highlighter-rouge">-h</code> produces normal output, unknown options produce error messages.)</p>

<p>Here‚Äôs example output.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./wordmod -h
Usage: ./wordmod [OPTIONS]

Options:
  -c NUM  Caesar cipher, shift by NUM
  -h      show this help
  -p      Pig Latin
  -r      reverse
  -s      shouty
</code></pre></div></div>

<p>If the user specifies multiple transformations, print an error message (on
<code class="highlighter-rouge">stderr</code>) and exit with a nonzero exit value.</p>

<p>If the word you read in is longer than 45 characters, do not perform any
transformations on it. Just output it as is. For the purposes of this
assignment, a word is considered a consecutive sequence of letters, digits,
and apostrophes. You may want to write a function <code class="highlighter-rouge">isword()</code>.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Returns true if ch is a letter, digit, or apostrophe.</span>
<span class="n">bool</span> <span class="nf">isword</span><span class="p">(</span><span class="kt">int</span> <span class="n">ch</span><span class="p">);</span>
</code></pre></div></div>

<p>Take a look at the man pages for <code class="highlighter-rouge">isalpha(3)</code> and <code class="highlighter-rouge">isdigit(3)</code>.</p>

<p>For each modification, you‚Äôre going to call a function and pass the string in
as input. The modification function will write the modification to another
string. For most of these, it‚Äôs important you don‚Äôt use the same array for
input and output. C won‚Äôt complain, but your code will likely crash or
otherwise misbehave!</p>

<p>You want something like the following.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">stdin</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">ferror</span><span class="p">(</span><span class="n">stdin</span><span class="p">))</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">word</span><span class="p">[</span><span class="n">INPUT_SIZE</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
  <span class="kt">char</span> <span class="n">modified</span><span class="p">[</span><span class="n">OUTPUT_SIZE</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">echo_until_word</span><span class="p">())</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">get_word</span><span class="p">(</span><span class="n">word</span><span class="p">))</span> <span class="p">{</span>
    <span class="cm">/* Handle an overly long word. */</span>
    <span class="k">continue</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">switch</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* ... */</span>
  <span class="k">case</span> <span class="sc">'s'</span><span class="p">:</span>
    <span class="n">shouty</span><span class="p">(</span><span class="n">modified</span><span class="p">,</span> <span class="n">word</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="cm">/* ... */</span>
  <span class="p">}</span>
  <span class="cm">/* print the modified word */</span>
<span class="p">}</span>
</code></pre></div></div>
<dl>
  <dt>where</dt>
  <dt><code class="highlighter-rouge">feof(3)</code> and <code class="highlighter-rouge">ferror(3)</code></dt>
  <dd>are standard library functions, check their man pages;</dd>
  <dt><code class="highlighter-rouge">echo_until_word()</code></dt>
  <dd>prints characters until it encounters a word character or <code class="highlighter-rouge">EOF</code>, returning
<code class="highlighter-rouge">true</code> if a word character was encountered and <code class="highlighter-rouge">false</code> if <code class="highlighter-rouge">EOF</code>;</dd>
  <dt><code class="highlighter-rouge">get_word()</code></dt>
  <dd>stores at most <code class="highlighter-rouge">INPUT_SIZE</code> word characters (plus a trailing <code class="highlighter-rouge">0</code> byte),
returning <code class="highlighter-rouge">true</code> if the next input character is either <code class="highlighter-rouge">EOF</code> or not a word
character.</dd>
  <dt><code class="highlighter-rouge">transform</code></dt>
  <dd>is the selected transformation; and</dd>
  <dt><code class="highlighter-rouge">shouty()</code></dt>
  <dd>is defined in <a href="#part-2-shouty">Part 2</a>.</dd>
</dl>

<p>For each of the functions described in the remaining parts, you might want to
add a <code class="highlighter-rouge">size_t size</code> parameter that is the size of your output array. You would
modify the code above to call it like</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">shouty</span><span class="p">(</span><span class="n">modified</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">modified</span><span class="p">);</span>
</code></pre></div></div>

<p>This size might be useful if you use <code class="highlighter-rouge">strlcpy(3)</code>/<code class="highlighter-rouge">strlcat(3)</code>. Note that if
you want to use those functions, you need to modify your <code class="highlighter-rouge">Makefile</code> to include
<code class="highlighter-rouge">-lbsd</code> at the end of the recipe for <code class="highlighter-rouge">wordmod</code>:</p>
<div class="language-make highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">wordmod</span><span class="o">:</span> <span class="nf">$(wordmod_objs)</span>
        <span class="err">$(CC)</span> <span class="err">$(LDFLAGS)</span> <span class="err">-o</span> <span class="err">$@</span> <span class="err">$^</span> <span class="err">-lbsd</span>
</code></pre></div></div>

<h1 id="part-2-shouty">Part 2. Shouty</h1>
<p>The first transformation is <em>shouty</em>. For this part, you should write a
function</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">shouty</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">output</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">input</span><span class="p">);</span>
</code></pre></div></div>
<p>which takes a string <code class="highlighter-rouge">input</code> and copies it to the string <code class="highlighter-rouge">output</code>, making each
character upper case.</p>

<p>This transformation should be used when the user passes the <code class="highlighter-rouge">-s</code> option.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ echo 'Sometimes I feel shouty!' | ./wordmod -s
SOMETIMES I FEEL SHOUTY!
</code></pre></div></div>

<p>The <code class="highlighter-rouge">toupper(3)</code> function may be useful.</p>

<h1 id="part-3-reverse">Part 3. Reverse</h1>
<p>The next transformation is <em>reverse</em>. For this part, you should write a
function</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">reverse</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">output</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">input</span><span class="p">);</span>
</code></pre></div></div>
<p>which takes <code class="highlighter-rouge">input</code> and reverses it into <code class="highlighter-rouge">output</code>.</p>

<p>This transformation should be used when the user passes the <code class="highlighter-rouge">-s</code> option.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ echo 'TACOCAT si a emordnilap' | ./wordmod -r
TACOCAT is a palindrome
</code></pre></div></div>

<h1 id="part-4-caesar-cipher">Part 4. Caesar cipher</h1>
<p>For this transformation, you should implement the <a href="https://en.wikipedia.org/wiki/Caesar_cipher">Caesar
cipher</a> with a variable shift
count. Letters should retain their case, digits and apostrophe should be
unchanged. The amount to shift should be given as an argument to the <code class="highlighter-rouge">-c</code>
option. Positive shift amounts should shift forward in the alphabet, negative
shift counts should shift backward. (See the examples below.)</p>

<p>Implement</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">caesar</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">output</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">input</span><span class="p">,</span> <span class="kt">int</span> <span class="n">shift_amount</span><span class="p">);</span>
</code></pre></div></div>
<p>which shifts each letter character of <code class="highlighter-rouge">input</code> by <code class="highlighter-rouge">shift_amount</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ echo '0 shifts given' | ./wordmod -c 0
0 shifts given
$ echo 'Fuvsg ol 13; irel fuvsgl!' | ./wordmod -c 13
Shift by 13; very shifty!
$ echo 'Vkliw lqwr uhyhuvh.' | ./wordmod -c -3
Shift into reverse.
</code></pre></div></div>

<p>Check out the man pages for <code class="highlighter-rouge">isupper(3)</code> and <code class="highlighter-rouge">islower(3)</code>.</p>

<h1 id="part-5-pig-latin">Part 5. Pig Latin</h1>
<p>For this part, you‚Äôll be implementing a transformation to turn English into
<a href="https://en.wikipedia.org/wiki/Pig_Latin">Pig Latin</a> (don‚Äôt worry about the
rules described on Wikipedia, just follow the ones given below).</p>

<p>Implement the function</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">pig</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">output</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">input</span><span class="p">);</span>
</code></pre></div></div>
<p>according to the following rules.</p>

<ol>
  <li>If the word contains anything but letters (which for our purposes means it
contains a digit or apostrophe), don‚Äôt transform it.</li>
  <li>If the word contains no vowels‚Äîa, e, i, o, u, or y‚Äîdon‚Äôt transform it.</li>
  <li>If the word starts with a, e, i, o, or u, append ‚Äúyay‚Äù.</li>
  <li>Otherwise move all of the characters before the first vowel‚Äîa, e, i, o, u, or
y‚Äîto the end of the word and append ‚Äúay‚Äù.</li>
</ol>

<p>The exception is that ‚Äúqu‚Äù should be treated a consonant in these rules. That
is, ‚Äúqu‚Äù remains ‚Äúqu‚Äù (because rule 2 says it has no vowels) and ‚Äúquite‚Äù
becomes ‚Äúitequay‚Äù rather than ‚Äúuiteqay‚Äù (because rule 4 says the first vowel
is the ‚Äúi‚Äù).</p>

<p>In addition to the rules above, you need to modify capitalization such that if
the input word stars with a capital letter, then the output word should start
with a capital letter and the original capital letter should be lowercased.
(See the examples below.)</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ echo "That'll do, pig." | ./wordmod -p
That'll oday, igpay.
$ echo 'Linux is pretty OK.' | ./wordmod -p
Inuxlay isyay ettypray OKyay.
</code></pre></div></div>

<p>You may find <code class="highlighter-rouge">strcspn(3)</code> useful.</p>
:ET