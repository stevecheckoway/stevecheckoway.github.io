<!DOCTYPE html><html lang=en><meta http-equiv=Content-Type content="text/html;charset=utf-8"> <meta http-equiv=X-UA-Compatible content="IE=edge"> <meta name=viewport content="width=device-width, initial-scale=1"><title>Lecture 20</title><meta name=description content="Lecture 20 – Oct 28th, 2019"> <link rel=canonical href=https://checkoway.net/teaching/cs241/2019-fall/exercises/Lecture-20.html> <link rel=stylesheet href=/css/main.css><main><h1 id=lecture-20--oct-28th-2019>Lecture 20 – Oct 28th, 2019</h1><h2 id=setup>Setup</h2><ol><li>Log in to clyde.<li><code class="language-plaintext highlighter-rouge">$ cp -r ~steve/ex/linenumbers .</code></ol><h2 id=task>Task</h2><ol><li>Modify <code class="language-plaintext highlighter-rouge">linenumbers.c</code> such that it reads a line from <code class="language-plaintext highlighter-rouge">stdin</code> using <code class="language-plaintext highlighter-rouge">fgets(3)</code> and writes to <code class="language-plaintext highlighter-rouge">stdout</code> using <code class="language-plaintext highlighter-rouge">fprintf(3)</code> (you’ll see why we’re using <code class="language-plaintext highlighter-rouge">fprintf(3)</code> rather than <code class="language-plaintext highlighter-rouge">printf(3)</code> shortly) except that each line should be prefixed with its line number as in this example. <div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>$ ./linenumbers &lt; Makefile
1: CC := clang
2: CFLAGS := -Wall -std=c11 -g -fsanitize=address,undefined
3: LDFLAGS := -fsanitize=address,undefined
4:
5: .PHONY: all clean
6:
7: all: linenumbers
8: clean:
9: 	$(RM) linenumbers
</code></pre></div></div><p>You may assume a line is no longer than 1024 characters for now.<li><p>Modify <code class="language-plaintext highlighter-rouge">linenumbers.c</code> such that if at least one argument is given (so <code class="language-plaintext highlighter-rouge">argc &gt; 1</code>), the first argument is treated as the file to read rather than <code class="language-plaintext highlighter-rouge">stdin</code>. I.e., open the file using <code class="language-plaintext highlighter-rouge">fopen(3)</code>. Make sure to handle the case where <code class="language-plaintext highlighter-rouge">fopen(3)</code> returns <code class="language-plaintext highlighter-rouge">NULL</code> by printing out an appropriate message using <code class="language-plaintext highlighter-rouge">perror(3)</code> and exiting with <code class="language-plaintext highlighter-rouge">EXIT_FAILURE</code>.<p>If no arguments are given, then behave as before, namely reading from <code class="language-plaintext highlighter-rouge">stdin</code>. You’ll probably want code that looks like<div class="language-c highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=kt>FILE</span> <span class=o>*</span><span class=n>input</span> <span class=o>=</span> <span class=n>stdin</span><span class=p>;</span>
<span class=k>if</span> <span class=p>(</span><span class=n>argc</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
  <span class=n>input</span> <span class=o>=</span> <span class=n>fopen</span><span class=p>(</span><span class=cm>/* ... */</span><span class=p>);</span>
  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>input</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// Handle the error.</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div></div><p>Here’s an example of the error handling.<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>$ ./linenumbers "does not exist"
does not exist: No such file or directory
$ echo $?
1
</code></pre></div></div><p>Make sure you <code class="language-plaintext highlighter-rouge">fclose(3)</code> the input when you’re done with it.<li><p>Modify <code class="language-plaintext highlighter-rouge">linenumbers.c</code> such that if no arguments are given, it behaves as in part 1. If one argument is given, it behaves as in part 2. If two arguments are given, the output is written to the file named by the second argument rather than to <code class="language-plaintext highlighter-rouge">stdout</code>. And if more than two arguments are given, it prints out a usage message and exits with <code class="language-plaintext highlighter-rouge">EXIT_FAILURE</code>.<p>Be careful that you don’t accidentally overwrite a file you care about.<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>$ ./linenumbers one two three
Usage: ./linenumbers [INPUT [OUTPUT]]
</code></pre></div></div><p>Make sure you <code class="language-plaintext highlighter-rouge">fclose(3)</code> the output when you’re done with it.<li><p>It’s traditional that if <code class="language-plaintext highlighter-rouge">-</code> is passed as a file name for input, then the input should come from <code class="language-plaintext highlighter-rouge">stdin</code> and if <code class="language-plaintext highlighter-rouge">-</code> is passed as a file name for output, then the output should go to <code class="language-plaintext highlighter-rouge">stdout</code>. Implement this functionality, using <code class="language-plaintext highlighter-rouge">strcmp(3)</code> from <code class="language-plaintext highlighter-rouge">string.h</code>.<div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>$ echo -e "Hello world\nHow are you?" | ./linenumbers - output.txt
$ cat output.txt
1: Hello world
2: How are you?
</code></pre></div></div><li>Modify <code class="language-plaintext highlighter-rouge">linenumbers.c</code> to remove the restriction on line lengths. You can use <code class="language-plaintext highlighter-rouge">strchr(3)</code> to search for a newline. If it doesn’t exist, output what you have so far, and then keep reading with <code class="language-plaintext highlighter-rouge">fgets(3)</code> until you reach the end of the line and output it using <code class="language-plaintext highlighter-rouge">fputs(3)</code>.<li>Modify <code class="language-plaintext highlighter-rouge">linenumbers.c</code> one final time to make sure that you handle error return values (which you really should have been doing all along) from each of the standard library functions: <code class="language-plaintext highlighter-rouge">fopen(3)</code> and <code class="language-plaintext highlighter-rouge">fgets(3)</code> return <code class="language-plaintext highlighter-rouge">NULL</code> on error; <code class="language-plaintext highlighter-rouge">fputs(3)</code> and <code class="language-plaintext highlighter-rouge">fclose(3) return </code>EOF<code class="language-plaintext highlighter-rouge"> on error; and </code>fprintf(3)` returns a negative number on error.</ol></main>