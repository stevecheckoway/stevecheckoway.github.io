<!DOCTYPE html><html lang=en><meta http-equiv=Content-Type content="text/html;charset=utf-8"> <meta http-equiv=X-UA-Compatible content="IE=edge"> <meta name=viewport content="width=device-width, initial-scale=1"><title>Lecture 14</title><meta name=description content="Lecture 14 – Oct 4th, 2019"> <link rel=canonical href=https://checkoway.net/teaching/cs241/2019-fall/exercises/Lecture-14.html> <link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.css integrity=sha384-TEMocfGvRuD1rIAacqrknm5BQZ7W7uWitoih+jMNFXQIbNl16bO8OZmylH/Vi/Ei crossorigin=anonymous> <link rel=stylesheet href=/css/main.css> <script>!function(e,t,a,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=t.createElement(a),s=t.getElementsByTagName(a)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-34500030-2","auto"),ga("send","pageview")</script><main><h1 id=lecture-14--oct-4th-2019>Lecture 14 – Oct 4th, 2019</h1><h2 id=setup>Setup</h2><ol><li>Log in to clyde.<li>Create a directory and <code class=highlighter-rouge>cd</code> into it.<li>Copy <code class=highlighter-rouge>~steve/ex/arr.c</code> into the directory.</ol><h2 id=task>Task</h2><ol><li>Look at the code for <code class=highlighter-rouge>arr.c</code>. It currently doesn’t do much more than look at its command line parameters. Compile the program and run it with a positive number, a negative number, 0, and something that isn’t a number but starts with a number like <code class=highlighter-rouge>35foo</code>.<li>Inside <code class=highlighter-rouge>main</code>, create a variable-length array, <code class=highlighter-rouge>seq</code>, of <code class=highlighter-rouge>int</code>s of size <code class=highlighter-rouge>n</code>. Initialize this array using a <code class=highlighter-rouge>for</code> loop such <code class=highlighter-rouge>seq[idx]</code> has the value <code class=highlighter-rouge>idx*idx</code> if <code class=highlighter-rouge>idx</code> is even and <code class=highlighter-rouge>-idx*idx</code> if <code class=highlighter-rouge>idx</code> is odd.<li>Write a function <div class="language-c highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=kt>int</span> <span class=nf>sum</span><span class=p>(</span><span class=kt>size_t</span> <span class=n>len</span><span class=p>,</span> <span class=kt>int</span> <span class=n>arr</span><span class=p>[</span><span class=n>len</span><span class=p>]);</span>
</code></pre></div></div><p>that computes and returns the sum of the elements of <code class=highlighter-rouge>arr</code>.<p>Inside <code class=highlighter-rouge>main</code>, print out the result of <code class=highlighter-rouge>sum(n, seq)</code>.<p>Compile and run the code with a few small values of the command line argument <code class=highlighter-rouge>NUM</code>. Make sure you compile with<div class=highlighter-rouge><div class=highlight><pre class=highlight><code>$ clang -Wall -std=c11 -o arr arr.c
</code></pre></div></div><p>and fix any warnings that appear.<li>Change the code to print out <code class=highlighter-rouge>sum(n+10, seq)</code> instead. Before you compile and run this, make a prediction as to what will happen? Now compile and run. Did it match your expectation?<li><p>In task 4, the code was changed so that the <code class=highlighter-rouge>sum</code> function would read beyond the end of the array. The compiler didn’t complain about this. At runtime, you got strange results, but there was no error or warning.<p><strong>This is bad. Nearly every C program in existence has a similar problem.</strong><p>Compile your program with<div class=highlighter-rouge><div class=highlight><pre class=highlight><code>$ clang -Wall -std=c11 -fsanitize=address,undefined -o arr arr.c
</code></pre></div></div><p>and run it again. This time it should crash with a colorful error message. This additional option tells the compiler (and the linker) to insert additional code in the program to detect these sorts of undefined behavior.<li><p>You can get a nice backtrace (a list of the functions that were called leading to the error) with a couple of more steps.<p>Compile with<div class=highlighter-rouge><div class=highlight><pre class=highlight><code>$ clang -Wall -std=c11 -fsanitize=address,undefined -g -o arr arr.c
</code></pre></div></div><p>where the additional <code class=highlighter-rouge>-g</code> option adds debugging information to the binary. Run the program with a particular environment variable set.<div class=highlighter-rouge><div class=highlight><pre class=highlight><code>$ ASAN_SYMBOLIZER_PATH=/usr/lib/llvm-6.0/bin/llvm-symbolizer ./arr 8
</code></pre></div></div><p>When I do that, I get the output<div class=highlighter-rouge><div class=highlight><pre class=highlight><code>==7410==ERROR: AddressSanitizer: dynamic-stack-buffer-overflow on address 0x7ffd4d3aee80 at pc 0x00000051222d bp 0x7ffd4d3aedd0 sp 0x7ffd4d3aedc8
READ of size 4 at 0x7ffd4d3aee80 thread T0
 #0 0x51222c in sum /usr/users/noquota/faculty/steve/inclass/arr.c:8:14
 #1 0x5128f8 in main /usr/users/noquota/faculty/steve/inclass/arr.c:25:18
 #2 0x7f7ab6782b96 in __libc_start_main /build/glibc-OTsEL5/glibc-2.27/csu/../csu/libc-start.c:310
 #3 0x419d59 in _start (/net/storage/zfs/faculty/steve/inclass/arr+0x419d59)
</code></pre></div></div><p>where this is telling me that the error happened in <code class=highlighter-rouge>arr.c</code> in the <code class=highlighter-rouge>sum</code> function on line 8, column 14. It also shows where <code class=highlighter-rouge>sum</code> was called from, namely <code class=highlighter-rouge>main</code> at line 25, column 18.</ol></main>