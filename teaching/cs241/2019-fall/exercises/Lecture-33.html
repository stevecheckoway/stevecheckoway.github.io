<!DOCTYPE html><html lang=en><meta http-equiv=Content-Type content="text/html;charset=utf-8"> <meta http-equiv=X-UA-Compatible content="IE=edge"> <meta name=viewport content="width=device-width, initial-scale=1"><title>Lecture 33</title><meta name=description content="Lecture 33 – Dec 2nd, 2019"> <link rel=canonical href=https://checkoway.net/teaching/cs241/2019-fall/exercises/Lecture-33.html> <link rel=stylesheet href=/css/main.css><main><h1 id=lecture-33--dec-2nd-2019>Lecture 33 – Dec 2nd, 2019</h1><h2 id=setup>Setup</h2><ol><li>Log in to clyde.<li>Create a new directory.</ol><h2 id=task>Task</h2><ol><li>Write a short program containing a function with the prototype <div class="language-c highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=kt>double</span> <span class=n>varsum</span><span class=p>(</span><span class=kt>int</span> <span class=n>num</span><span class=p>,</span> <span class=p>...)</span>
</code></pre></div></div><p>where the <code class="language-plaintext highlighter-rouge">num</code> parameter controls how many additional <code class="language-plaintext highlighter-rouge">double</code> parameters there are. <code class="language-plaintext highlighter-rouge">varsum</code> should add up all of the double parameters and return the result. If <code class="language-plaintext highlighter-rouge">num &lt;= 0</code>, return <code class="language-plaintext highlighter-rouge">0.0</code>.<li><p>The <code class="language-plaintext highlighter-rouge">printf</code> family of functions includes (among others) <code class="language-plaintext highlighter-rouge">printf(3)</code>, <code class="language-plaintext highlighter-rouge">fprintf(3)</code>, <code class="language-plaintext highlighter-rouge">vprintf(3)</code>, and <code class="language-plaintext highlighter-rouge">vfprintf(3)</code>. The first three can easily be written in terms of the fourth.<p>Write four similar functions<div class="language-c highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=kt>void</span> <span class=nf>msg</span><span class=p>(</span><span class=kt>char</span> <span class=k>const</span> <span class=o>*</span><span class=n>type</span><span class=p>,</span> <span class=kt>char</span> <span class=k>const</span> <span class=o>*</span><span class=n>fmt</span><span class=p>,</span> <span class=p>...);</span>
<span class=kt>void</span> <span class=nf>vmsg</span><span class=p>(</span><span class=kt>char</span> <span class=k>const</span> <span class=o>*</span><span class=n>type</span><span class=p>,</span> <span class=kt>char</span> <span class=k>const</span> <span class=o>*</span><span class=n>fmt</span><span class=p>,</span> <span class=kt>va_list</span> <span class=n>ap</span><span class=p>);</span>
<span class=kt>void</span> <span class=nf>fmsg</span><span class=p>(</span><span class=kt>FILE</span> <span class=o>*</span><span class=n>fp</span><span class=p>,</span> <span class=kt>char</span> <span class=k>const</span> <span class=o>*</span><span class=n>type</span><span class=p>,</span> <span class=kt>char</span> <span class=k>const</span> <span class=o>*</span><span class=n>fmt</span><span class=p>,</span> <span class=p>...);</span>
<span class=kt>void</span> <span class=nf>vfmsg</span><span class=p>(</span><span class=kt>FILE</span> <span class=o>*</span><span class=n>fp</span><span class=p>,</span> <span class=kt>char</span> <span class=k>const</span> <span class=o>*</span><span class=n>type</span><span class=p>,</span> <span class=kt>char</span> <span class=k>const</span> <span class=o>*</span><span class=n>fmt</span><span class=p>,</span> <span class=kt>va_list</span> <span class=n>ap</span><span class=p>);</span>
</code></pre></div></div><p>where the intended behavior is<div class="language-c highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=n>msg</span><span class=p>(</span><span class=s>"Info"</span><span class=p>,</span> <span class=s>"0x%x %d"</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>5</span><span class=p>);</span>
</code></pre></div></div><p>prints <code class="language-plaintext highlighter-rouge">[Info] 0x20 5</code>.<p>Implement the first three in terms of the fourth. Feel free to use <code class="language-plaintext highlighter-rouge">fprintf(3)</code>, <code class="language-plaintext highlighter-rouge">vfprintf(3)</code>, or other standard I/O functions to implement <code class="language-plaintext highlighter-rouge">vfmsg</code>.<p>Write a short program that tests them.<li><p>The <code class="language-plaintext highlighter-rouge">execl(3)</code> function takes a path and a variable number of arguments. The end of the argument list is denoted by an explicit <code class="language-plaintext highlighter-rouge">(char *)0</code>.<p>Using the same strategy of marking the end of the list with <code class="language-plaintext highlighter-rouge">(char *)0</code>, write a function<div class="language-c highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=kt>char</span> <span class=o>*</span><span class=n>join</span><span class=p>(</span><span class=kt>char</span> <span class=k>const</span> <span class=o>*</span><span class=n>sep</span><span class=p>,</span> <span class=p>...)</span>
</code></pre></div></div><p>That allocates and returns a string consisting of the variable number of strings joined together but separated the string <code class="language-plaintext highlighter-rouge">sep</code>. For example,<div class="language-c highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=n>join</span><span class=p>(</span><span class=s>" "</span><span class=p>,</span> <span class=s>"This"</span><span class=p>,</span> <span class=s>"is"</span><span class=p>,</span> <span class=s>"a"</span><span class=p>,</span> <span class=s>"sentence."</span><span class=p>,</span> <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=mi>0</span><span class=p>);</span><span class=err>`</span>
</code></pre></div></div><p>should return the string <code class="language-plaintext highlighter-rouge">"This is a sentence."</code>;<div class="language-c highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=n>join</span><span class=p>(</span><span class=s>"foo"</span><span class=p>,</span> <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=mi>0</span><span class=p>);</span>
</code></pre></div></div><p>should return the empty string <code class="language-plaintext highlighter-rouge">""</code>; and<div class="language-c highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=n>join</span><span class=p>(</span><span class=s>"+-+"</span> <span class=s>"a"</span><span class=p>,</span> <span class=s>"b"</span><span class=p>,</span> <span class=s>"c"</span><span class=p>,</span> <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=mi>0</span><span class=p>);</span>
</code></pre></div></div><p>should return the string <code class="language-plaintext highlighter-rouge">"a+-+b+-+c"</code>.<p>In all cases, the string should be allocated via <code class="language-plaintext highlighter-rouge">malloc(3)</code> or <code class="language-plaintext highlighter-rouge">realloc(3)</code>. Make sure you don’t leak memory.<p>Write a short program to test your functions. The strings returned from <code class="language-plaintext highlighter-rouge">join</code> should ultimately be passed to <code class="language-plaintext highlighter-rouge">free(3)</code>.</ol></main>