<!DOCTYPE html><html lang=en><meta http-equiv=Content-Type content="text/html;charset=utf-8"> <meta http-equiv=X-UA-Compatible content="IE=edge"> <meta name=viewport content="width=device-width, initial-scale=1"><title>Portably solving the access(2)/open(2) race</title><meta name=description content="Tiny Transactions on Computer Science (TinyToCS) 1, Sep. 2012."> <link rel=canonical href=https://checkoway.net/papers/accessopen2012/> <link rel=stylesheet href=/css/main.css><main><article vocab=http://schema.org typeof=ScholarlyArticle resource=accessopen2012.pdf><h1 class=paper-title property=headline>Portably solving the access(2)/open(2) race</h1><p>By <span property=author typeof=Person><span property=name><a href=https://checkoway.net property=url>Stephen Checkoway</a></span></span>.<p><a href=http://tinytocs.org>Tiny Transactions on Computer Science (TinyToCS)</a> 1, Sep. 2012.<h2 id=abstract>Abstract</h2><p>The access(2)/open(2) file-system race is the canonical example of a time-of-check-to-time-of-use (TOCTTOU) error in which a setuid binary checks that a user has permission to open a file prior to opening it. By changing the state of the file-system between the calls to access(2) and open(2), an attacker can cause the program to open a file to which the user does not have access. This race has been the focus of several papers alternately trying to defend against the race and attacking the defenses. In this paper, we give a simple solution that avoids the race condition in all POSIX.1-conformant operating systems such as Mac OS X 10.6.8, Linux 2.6.35, FreeBSD 8.2, NetBSD 5.1, OpenBSD 4.9, Dragonfly BSD 2.10.1, and Solaris 10. In other words, most modern, UNIX-like operating systems.<p>Dean and Hu explicitly reject a solution based on temporarily changing user ids writing, “a solution depending on user id juggling can be made to work, but is generally not portable.” This may have been true in 2004, but is no longer the case today as all modern UNIX-like operating systems correctly implement the seteuid(2)/setegid(2) system calls—note the ‘e’ for “effective.” Rather than testing if a file can be opened and then opening it, a secure setuid program should use seteuid(2)/setegid(2) and simply open(2) the file. If the open(2) call fails with errno set to EPERM, then the user/group did not have permission to open the file. If the call succeeds, then the user/group had permission.<h2 id=body>Body</h2><p><i>access(2)/open(2) file-system races can be prevented by omitting access(2) and using seteuid(2)/setegid(2) before open(2) on a modern OS.</i><h2 id=material>Material</h2><ul><li>Journal version in <a href=http://tinytocs.org/vol1/papers/tinytocs-v1-checkoway.pdf>PDF</a>.<li>Local copy in <a href=accessopen2012.pdf>PDF</a>.</ul><h2 id=reference>Reference</h2><div class="language-bibtex highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=nc>@Article</span><span class=p>{</span><span class=nl>checkoway:accessopen:tinytocs12</span><span class=p>,</span>
  <span class=na>author</span> <span class=p>=</span>  <span class=s>{Stephen Checkoway}</span><span class=p>,</span>
  <span class=na>title</span> <span class=p>=</span>   <span class=s>{Portably solving the access(2)/open(2) race}</span><span class=p>,</span>
  <span class=na>journal</span> <span class=p>=</span> <span class=s>{Tiny Transactions on Computer Science}</span><span class=p>,</span>
  <span class=na>year</span> <span class=p>=</span>    <span class=m>2012</span><span class=p>,</span>
  <span class=na>month</span> <span class=p>=</span>   <span class=nv>sep</span><span class=p>,</span>
  <span class=na>volume</span> <span class=p>=</span>  <span class=m>1</span><span class=p>,</span>
  <span class=na>url</span> <span class=p>=</span>     <span class=s>{https://checkoway.net/papers/accessopen2012/index.html}</span><span class=p>,</span>
<span class=p>}</span>
</code></pre></div></div></article></main>